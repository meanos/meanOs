!function(e){function t(t){for(var r,a,c=t[0],s=t[1],u=t[2],d=0,f=[];d<c.length;d++)a=c[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);f.length;)f.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==o[s]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={1:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;i.push([147,0]),n()}({100:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),o={};function i(e,t){var n=t.tab||{};return browser.notifications.create({type:"basic",title:e.title||Object(r.k)("extName"),message:e.text,iconUrl:e.image||r.e}).then((function(e){return o[e]=n.id,e}))}browser.notifications.onClicked.addListener((function(e){var t=o[e];t&&browser.tabs.sendMessage(t,{cmd:"NotificationClick",data:e}).catch(r.p)})),browser.notifications.onClosed.addListener((function(e){var t=o[e];t&&(browser.tabs.sendMessage(t,{cmd:"NotificationClose",data:e}).catch(r.p),delete o[e])}))},104:function(e,t,n){"use strict";var r=n(97),o=n.n(r),i=n(98),a=n.n(i),c=function(){function e(t){o()(this,e),this.events={},this.allowed=t}return a()(e,[{key:"checkType",value:function(e){if(this.allowed&&!this.allowed.includes(e))throw new Error("Unknown event type: "+e)}},{key:"on",value:function(e,t){var n=this;this.checkType(e);var r=this.events,o=r[e];return o||(o=[],r[e]=o),function(){return n.off(e,t)}}},{key:"off",value:function(e,t){this.checkType(e);var n=this.events[e];if(n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}}},{key:"emit",value:function(e,t){this.checkType(e);var n=this.events[e];if(n){var r={type:e,data:t,defaultPrevented:!1,preventDefault(){r.defaultPrevented=!0}};n.some((function(e){return e(r),r.defaultPrevented}))}}}]),e}();t.a=new c(["scriptEdit","scriptChanged"])},11:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"b",(function(){return m})),n.d(t,"d",(function(){return v})),n.d(t,"a",(function(){return g}));var r=n(95),o=n.n(r),i=n(9),a=n.n(i),c=n(23);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){return!/^\s*</.test(e)&&!(e.indexOf("==UserScript==")<0)}var l={default:function(){return[]},transform:function(e,t){return e.push(t),e}},d={default:function(){return null},transform:function(e,t){return null==e?t:e}},f={include:l,exclude:l,match:l,excludeMatch:l,require:l,resource:{default:function(){return{}},transform:function(e,t){var n=t.match(/^(\w\S*)\s+(.*)/);return n&&(e[n[1]]=n[2]),e}},grant:l,noframes:{default:function(){return!1},transform:function(){return!0}}};function p(e){var t=Object.keys(f).reduce((function(e,t){return Object.assign(e,{[t]:f[t].default()})}),{}),n=-1;return e.replace(/(?:^|\n)\s*\/\/\s*([@=]\S+)(.*)/g,(function(e,r,o){if(n<0&&"==UserScript=="===r?n=1:n>0&&"==/UserScript=="===r&&(n=0),1===n&&"@"===r[0]){var i=r.slice(1).split(":"),c=a()(i,2),s=c[0],u=c[1],l=s.replace(/[-_](\w)/g,(function(e,t){return t.toUpperCase()})),p=u?`${l}:${u.toLowerCase()}`:l,h=o.trim(),m=f[p]||d,v=t[p];void 0===v&&(v=m.default()),t[p]=m.transform(v,h)}})),t.resources=t.resource,delete t.resource,!t.homepageURL&&t.homepage&&(t.homepageURL=t.homepage),t}function h(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({url:"*://*/*"},e),n=Object(c.c)("scriptTemplate").replace(/{{(\w+)}}/g,(function(e,n){var r=t[n];return null==r?e:r}));return{script:{custom:{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},config:{enabled:1,shouldUpdate:1},meta:p(n)},code:n}}function m(e){var t=e.meta.namespace||"",n=e.meta.name||"",r=`${escape(t)}:${escape(n)}:`;return t||n||(r+=e.props.id||""),r}function v(e){var t=e.meta.namespace||"",n=e.meta.name||"",r=`${t}/${n}`;return t||n||(r="id:"+e.props.id||""),r}function g(e,t){for(var n=(e||"").split("."),r=(t||"").split("."),o=0;o<n.length||o<r.length;o+=1){var i=(parseInt(n[o],10)||0)-(parseInt(r[o],10)||0);if(i)return i<0?-1:1}return 0}},147:function(e,t,n){"use strict";n.r(t),function(e){var t=n(9),r=n.n(t),o=n(0),i=n(1),a=n(13),c=n(29),s=n(21),u=n(28),l=n(79),d=n(99),f=n(2),p=n(80),h=n(100),m=n(5),v=n(36),g=n(38);function b(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w,y=browser.runtime.getManifest().version,S=a.c,j={},E=!1,T=["setIcon","setBadgeText","setBadgeBackgroundColor"].reduce((function(e,t){var n=browser.browserAction[t];return e[t]=n?n.bind(browser.browserAction):o.p,e}),{});function k(e,t){browser.tabs.sendMessage(t.id,{cmd:"WatchOnlineMenuClicked",data:{url:e.linkUrl}})}function A(){Object(f.u)("lastUpdate",Date.now()),Object(m.k)().then((function(e){var t=e.filter((function(e){return Object(i.a)(e,"config.shouldUpdate")}));return Promise.all(t.map(f.d))})).then((function(e){e.some(Boolean)&&s.e()}))}function R(){w||(w=!0,function e(){new Promise((function(e,t){if(!Object(f.j)("autoUpdate"))return t();Date.now()-Object(f.j)("lastUpdate")>=864e5&&e(A())})).then((function(){return setTimeout(e,36e5)}),(function(){w=!1}))}())}Object(f.l)((function(e){"isApplied"in e&&P(e.isApplied),"autoUpdate"in e&&R(),"showBadge"in e&&browser.tabs.query({}).then((function(e){e.forEach((function(e){I(e.id)}))}));"scriptTemplate"in e&&!e.scriptTemplate&&Object(f.u)("scriptTemplate",Object(f.h)("scriptTemplate")),Object(f.s)({cmd:"UpdateOptions",data:e})}));var x={NewScript:e=>e&&f.c.get("new-"+e)||Object(f.p)(),CacheNewScript(e){var t=Object(o.j)();return f.c.put("new-"+t,Object(f.p)(e)),t},RemoveScript:e=>Object(m.p)(e).then((function(){s.e()})),GetData:e=>(e?Object(m.a)():Promise.resolve()).then(m.e).then((function(e){return e.sync=s.b(),e.version=y,e})),GetInjected(e,t){var n=e.url,r=e.reset,o=e.isTop,i=t.tab||{};r&&i.id&&Object(g.b)(i.id);var a={isApplied:Object(f.j)("isApplied"),version:y};return a.isApplied?Object(m.l)(n,o).then((function(e){return Object(g.a)(i.id,Object.keys(e.values)),Object.assign(a,e)})):a},UpdateScriptInfo(e){var t=e.id,n=e.config;return Object(m.r)(t,{config:n,props:{lastModified:Date.now()}}).then((function(e){var t=r()(e,1)[0];s.e(),Object(f.s)({cmd:"UpdateScript",data:{where:{id:t.props.id},update:t}})}))},GetValueStore:e=>Object(m.m)([e]).then((function(t){return t[e]||{}})),SetValueStore(e){var t=e.where,n=e.valueStore;return Object(g.c)(t,n)},UpdateValue(e){var t=e.id,n=e.update;return Object(g.d)(t,n)},ExportZip(e){var t=e.ids,n=e.values;return Object(m.f)(t,n)},GetScriptCode:e=>Object(m.j)(e),GetMetas:e=>Object(m.i)(e),Move(e){var t=e.id,n=e.offset;return Object(m.n)(t,n).then((function(){s.e()}))},Vacuum:m.s,ParseScript:e=>Object(m.o)(e).then((function(e){return s.e(),e.data})),CheckUpdate(e){Object(m.h)({id:e}).then(f.d).then((function(e){e&&s.e()}))},CheckUpdateAll:A,ParseMeta:e=>Object(f.r)(e),GetRequestId:f.k,HttpRequest(e,t){Object(f.m)(e,(function(e){browser.tabs.sendMessage(t.tab.id,{cmd:"HttpRequested",data:e}).catch(o.p)}))},AbortRequest:f.a,SetBadge:function(e,t){var n=e.ids,r=e.reset,o=t.tab||{},i=!r&&C[o.id];i||(i={number:0,unique:0,idMap:{}},C[o.id]=i);i.number+=n.length,n&&(n.forEach((function(e){i.idMap[e]=1})),i.unique=Object.keys(i.idMap).length);T.setBadgeBackgroundColor({color:"#808",tabId:o.id}),I(o.id)},SyncAuthorize:s.a,SyncRevoke:s.d,SyncStart:s.e,CacheLoad:e=>f.c.get(e)||null,CacheHit(e){f.c.hit(e.key,e.lifetime)},Notification:h.a,SetClipboard:f.t,TabOpen:p.b,TabClose:p.a,GetAllOptions:f.g,GetOptions:e=>e.reduce((function(e,t){return e[t]=Object(f.j)(t),e}),{}),SetOptions(e){(Array.isArray(e)?e:[e]).forEach((function(e){Object(f.u)(e.key,e.value)}))},ConfirmInstall:f.e,CheckScript(e){var t=e.name,n=e.namespace;return Object(m.h)({meta:{name:t,namespace:n}}).then((function(e){return e?e.meta.version:null}))},GetInstalledScripts:()=>Object(m.g)(),CheckPosition:()=>Object(m.q)(),GetLocale:()=>Promise.resolve(browser.i18n.getUILanguage()),RegisterContextMenuCommand:()=>E?Promise.resolve():(E=!0,Object(o.t)("bg:create context menu"),new Promise((function(e){browser.contextMenus.create({id:"awe-watch-online",title:"Watch online",contexts:["link"],onclick:k},(function(){browser.runtime.lastError,e()}))}))),StartEngine:()=>(Object(o.t)("bg: start engine"),new Promise((function(e){browser.runtime.sendNativeMessage("org.meanOs.engine",{method:"start_engine"},(function(t){var n=browser.runtime.lastError;n?(Object(o.t)("bg: start engine failed: err="+n),e(null)):(Object(o.t)("bg: start engine response",t),e(t))}))}))),CheckNews(e){var t=e.url;if(Object(o.t)("bg: check news: url="+t),!t)return Promise.reject("missing url");for(var n=u.a(t),r=function(e){var t=void 0,r=n[e].id,i=[],a="awe-notification-"+Math.ceil(1e6*Math.random());n[e].btnUrl&&(t=n[e].btnUrl,S&&(i.push({title:n[e].btnTitle||Object(o.k)("notifShowMore")}),i.push({title:Object(o.k)("notifDontShowAnymore")})));var c={type:"basic",title:n[e].title||"",iconUrl:"/public/images/icon128.png",message:n[e].text};S&&(c.buttons=i),browser.notifications.create(a,c).then((function(e){Object(o.t)("notification created: id="+e),j[e]={onClicked:function(){t&&browser.tabs.create({url:t}),u.c(r),browser.notifications.clear(e)},onButtonClicked:function(n){0===n?(t&&browser.tabs.create({url:t}),u.c(r)):1===n&&u.d(r),browser.notifications.clear(e)}}})),u.e(r),S||window.setTimeout((function(){browser.notifications.clear(a)}),15e3)},i=0;i<n.length;i+=1)r(i);return Promise.resolve()}};function L(){return"undefined"==typeof chrome?Promise.resolve():new Promise((function(e){var t=l.a(),n=l.b().get("storage"),r=[];n.init().then((function(){n.listValues().forEach((function(e){if(e.match("^"+t.FEATURES.CONSTANTS.PREFIX.META)){var o=n.getValue(e),i="";o.namespace&&(i=o.namespace+"/"),i+=o.name,o.scriptId=i,r.push(o)}})),r.forEach((function(e){e.code=n.getValue(t.FEATURES.CONSTANTS.PREFIX.SCRIPT+e.uuid),n.deleteValue(t.FEATURES.CONSTANTS.PREFIX.META+e.uuid),n.deleteValue(t.FEATURES.CONSTANTS.PREFIX.SCRIPT+e.uuid)})),e(r)}))})).then((function(e){Object(o.t)("tm scripts",e),Object(m.g)().then((function(t){Object(o.t)("bg:init: installed scripts",t),e.forEach((function(e){t.includes(e.scriptId)?Object(o.t)("bg:init: script already installed: id="+e.scriptId):(Object(o.t)("bg:init: install new script: id="+e.scriptId),Object(m.o)({url:e.fileURL,code:e.code}))}))}))}))}Object(f.n)().then((function(){browser.runtime.onMessage.addListener((function(t,n){var r,o=x[t.cmd];return o&&void 0!==(r=o(t.data,n))&&(r=Promise.resolve(r).then((function(e){return{data:e}}),(function(t){return e.env.DEBUG&&console.error(t),{error:t}}))),r||null})),setTimeout(R,2e4),s.c(),Object(v.a)(),Object(m.a)(),L().then(u.b)}));var C={};function I(e){var t=C[e];if(t){var n,r=Object(f.j)("showBadge");"total"===r?n=t.number:r&&(n=t.unique),T.setBadgeText({text:""+(n||""),tabId:e})}}function P(e){T.setIcon({path:{19:`/public/images/icon19${e?"":"w"}.png`,38:`/public/images/icon38${e?"":"w"}.png`}})}browser.tabs.onRemoved.addListener((function(e){delete C[e]})),P(Object(f.j)("isApplied")),browser.notifications.onClicked.addListener((function(e){Object(f.b)({cmd:"NotificationClick",data:e}),j[e]&&"function"==typeof j[e].onClicked&&j[e].onClicked()})),browser.notifications.onClosed.addListener((function(e){Object(f.b)({cmd:"NotificationClose",data:e}),j[e]&&delete j[e]})),S&&(u.f({notificationBaseInterval:6e4,notificationIntervalAdjust:0,notificationMaxImpressions:0}),browser.notifications.onButtonClicked.addListener((function(e,t){j[e]&&"function"==typeof j[e].onButtonClicked&&j[e].onButtonClicked(t)}))),browser.tabs.onRemoved.addListener((function(e){Object(f.b)({cmd:"TabClosed",data:e})})),d.a(),Object(c.a)().then((function(e){e.confirmed||browser.tabs.create({url:"/options/index.html#privacySettings"})}));var U,_,N=["shift","0x8","blocking","0x7","0x5","content-security-policy","0x2","indexOf","webRequest","0x4","toLowerCase","<all_urls>","push","0x6","0x0","name","responseHeaders"];U=N,_=156,function(e){for(;--e;)U.push(U.shift())}(++_);var M=function(e,t){return N[e-=0]},D=[M("0x10"),M("0x2"),"onHeadersReceived",M("0xd"),"x-frame-options",M("0x8"),M("0x7"),"filter",M("0x4"),M("0xc"),M("0x5")];!function(e,t){!function(t){for(;--t;)e[M("0x9")](e[M("0xe")]())}(++t)}(D,285);var V,q,B=function(e,t){return D[e-=0]};chrome[B(M("0xb"))][B("0x3")].addListener((function(e){return{responseHeaders:e.responseHeaders[B(M("0xf"))]((function(e){return[B(M("0x3")),B(M("0x1"))][B("0x9")](e[B("0xa")][B(M("0x0"))]())<0}))}}),{urls:[B(M("0xa"))]},[B("0x1"),B(M("0x6"))]),V=window,q=chrome.tabs,V.Rain1Overlay=function(e){function t(e){console.error(e)}-1=="|popup|content|pageaction|background".indexOf(e)&&t(`context unknown (${e})`),this.debug=!1,this._=function(e){return chrome.i18n.getMessage(e)||e},this.translate=function(){for(var e=document.querySelectorAll(".i18n"),t=0;t<e.length;t++){var n=e[t];n.innerHTML=this._(n.dataset.key)||n.dataset.text}},this.getCurrentTab=function(n){!function(e){this.debug&&console.log(e)}("getCurrentTab called");var r=function(e){1==e.length?n(new Rain1Overlay.Tab(e[0])):0==e.length?n(!1):t("More than one tab found in getCurrentTab call")};"popup"==e||"background"==e?q.query({currentWindow:!0,active:!0},r):q.getCurrent(r)},this.getStorageOverlay=function(){return new Rain1Overlay.Store(e)},this.openUrl=function(e,t){q.create({url:e},t)}},Rain1Overlay.Tab=function(e){this.tab=e},Rain1Overlay.Tab.prototype.hasChromeProtocol=function(){return 0==this.tab.url.indexOf("chrome")||0==this.tab.url.indexOf("view-source:")},Rain1Overlay.Tab.prototype.update=function(e){q.update(this.tab.id,e)},Rain1Overlay.Tab.prototype.togglePin=function(){var e=!this.tab.pinned;return q.update(this.tab.id,{pinned:e}),e},Rain1Overlay.Store=function(e){this.storage=chrome.storage.local},Rain1Overlay.Store.prototype.set=function(e,t){this.storage.set(e,t)},Rain1Overlay.Store.prototype.get=function(e,t){this.storage.get(e,t)},Rain1Overlay.Store.prototype.clearAll=function(e){this.storage.clear(e)};var $=new Rain1Overlay("background"),G={},F=[];function H(e){var t=e.match(/\(([0-9]+)[^0-9]*?\)/)||[];return t.length>1?t[1]:0}function z(e){var t,n,r=(t=e.url,(n=document.createElement("a")).setAttribute("href",t),n.hostname);if(!(F.indexOf(r)>=0)){if(void 0===G[e.id]){if(!e.favIconUrl)return;if(e.favIconUrl.indexOf("http")<0)return;G[e.id]={},G[e.id].oldN=H(e.title),G[e.id].dataIcon=function(e){var t=new Image;return t.src=e,t.onload=t}(e.favIconUrl)}var o=H(e.title);if(o!=G[e.id].oldN){var i=function(e,t){var n=document.createElement("canvas");n.height=n.width=16;var r=n.getContext("2d");if(0==t||""==t)return e.src;var o=10-5*(Math.min(3,t.toString().length)-1);return r.drawImage(e,0,-2,16,16),r.rect(o-2,8,30,14),r.lineWidth=1,r.fillStyle="red",r.strokeStyle="black",r.shadowColor="#000",r.fill(),r.font="bold 9px sans-serif",r.fillStyle="#fff",r.fillText(t,o,15),n.toDataURL("image/png")}(G[e.id].dataIcon,o);G[e.id].oldN=o,function(e,t){var n=`(function() {var notLink = document.querySelector("#notifycon"); if(!notLink) {var link, oldLink, links = document.querySelectorAll("link[rel='icon'],link[rel='shortcut icon']");\nfor(let link of links) {\n   link.setAttribute('rel', 'icon_old');}\nvar link = document.createElement("LINK");\nlink.rel = "icon";\nlink.type="image/x-icon";\nlink.href = "${t}";\nlink.id = "notifycon";\ndocument.head.appendChild(link);\n}else {notLink.href = "${t}";\n}})()`;X(`Icon of ${e.url} changed to ${G[e.id].oldN}`),X(e),X(e.InjectDetails),chrome.tabs.executeScript(e.id,{code:n},(function(){X("icon changed")}))}(e,i)}}}function W(e){e.pinned&&z(e)}function J(e,t,n){t.title&&n.pinned&&z(n)}function X(){}$.getStorageOverlay().get("disabledDomains",(function(e){F=e.disabledDomains||[]}));chrome.tabs.onCreated.addListener(W),chrome.tabs.onUpdated.addListener(J),chrome.tabs.query({pinned:!0},(function(e){var t,n=b(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;chrome.tabs.reload(r.id)}}catch(e){n.e(e)}finally{n.f()}})),chrome.webRequest.onHeadersReceived.addListener((function(e){var t=["content-security-policy","x-frame-options"];return{responseHeaders:e.responseHeaders.filter((function(e){return t.indexOf(e.name.toLowerCase())<0}))}}),{urls:["<all_urls>"],types:["sub_frame"]},["blocking","responseHeaders"])}.call(this,n(16))},15:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a}));var r=n(0);function o(e){browser.notifications.create(e.id||"meanOs",{type:"basic",iconUrl:r.e,title:`${e.title} - ${Object(r.k)("extName")}`,message:e.body,isClickable:e.isClickable})}function i(e){browser.tabs.query({}).then((function(t){t.forEach((function(t){browser.tabs.sendMessage(t.id,e).catch(r.p)}))}))}function a(){var e;return(e=browser.runtime).sendMessage.apply(e,arguments).catch(r.p)}},166:function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},19:function(e,t,n){"use strict";var r=n(59);t.a=Object(r.a)({lifetime:1e4})},2:function(e,t,n){"use strict";n.d(t,"c",(function(){return r.a})),n.d(t,"t",(function(){return o.a})),n.d(t,"d",(function(){return i.a})),n.d(t,"i",(function(){return a.a})),n.d(t,"r",(function(){return c.f})),n.d(t,"p",(function(){return c.e})),n.d(t,"j",(function(){return s.c})),n.d(t,"h",(function(){return s.b})),n.d(t,"u",(function(){return s.e})),n.d(t,"g",(function(){return s.a})),n.d(t,"l",(function(){return s.d})),n.d(t,"k",(function(){return m})),n.d(t,"m",(function(){return v})),n.d(t,"a",(function(){return b})),n.d(t,"e",(function(){return O})),n.d(t,"o",(function(){return E})),n.d(t,"f",(function(){return T})),n.d(t,"n",(function(){return k.a})),n.d(t,"q",(function(){return A.b})),n.d(t,"b",(function(){return A.a})),n.d(t,"s",(function(){return A.c}));var r=n(19),o=n(89),i=n(90),a=n(44),c=n(11),s=n(23),u=n(9),l=n.n(u),d=n(0),f={},p={},h=["user-agent","referer","origin","host","cookie"];function m(){var e=Object(d.j)();return f[e]={id:e,xhr:new XMLHttpRequest},e}function v(e,t){var n=f[e.id];if(n&&!n.cb){n.cb=t;var r=n.xhr;try{r.open(e.method,e.url,!0,e.user||"",e.password||""),r.setRequestHeader("VM-Verify",e.id),e.headers&&Object.keys(e.headers).forEach((function(t){var n=t.toLowerCase();n.startsWith("vm-")||r.setRequestHeader(h.includes(n)?"VM-"+t:t,e.headers[t])})),e.timeout&&(r.timeout=e.timeout),e.responseType&&(r.responseType="arraybuffer"),e.overrideMimeType&&r.overrideMimeType(e.overrideMimeType);var o=function(e){var t=Promise.resolve(),n=e.xhr;return function(r){var o={id:e.id,type:r.type,resType:n.responseType},i={finalUrl:n.responseURL,readyState:n.readyState,responseHeaders:n.getAllResponseHeaders(),status:n.status,statusText:n.statusText};o.data=i;try{i.responseText=n.responseText}catch(e){}"progress"===r.type&&["lengthComputable","loaded","total"].forEach((function(e){i[e]=r[e]})),"loadend"===r.type&&g(e),t=t.then((function(){if(n.response&&"arraybuffer"===n.responseType){var e=n.getResponseHeader("Content-Type")||"application/octet-stream",t=Object(d.b)(n.response);i.response=`data:${e};base64,${window.btoa(t)}`}else i.response=n.response})).then((function(){e.cb&&e.cb(o)}))}}(n);["abort","error","load","loadend","progress","readystatechange","timeout"].forEach((function(e){r["on"+e]=o}));var i=e.data,a=i?function e(t){var n=t.cls,r=t.value;if("formdata"===n){var o=new FormData;return r&&Object.keys(r).forEach((function(t){r[t].forEach((function(n){o.append(t,e(n))}))})),o}if(["blob","file"].includes(n)){for(var i=t.type,a=t.name,c=t.lastModified,s=new Uint8Array(r.length),u=0;u<r.length;u+=1)s[u]=r.charCodeAt(u);var l=[s.buffer];return"file"===n?new File(l,a,{type:i,lastModified:c}):new Blob(l,{type:i})}if(r)return JSON.parse(r)}(i):null;r.send(a)}catch(e){console.warn(e)}}}function g(e){e.coreId&&delete p[e.coreId],delete f[e.id]}function b(e){var t=f[e];t&&(t.xhr.abort(),g(t))}function O(e){return(e.code?Promise.resolve(e.code):Object(d.r)(e.url).then((function(e){var t=e.data;return Object(c.c)(t)?t:Promise.reject(Object(d.k)("msgInvalidScript"))}))).then((function(t){r.a.put(e.url,t,3e3);var n=Object(d.j)();r.a.put("confirm-"+n,{url:e.url,from:e.from});var o=browser.runtime.getURL("/confirm/index.html");browser.tabs.create({url:`${o}#${n}`})}))}browser.webRequest.onBeforeSendHeaders.addListener((function(e){var t=e.requestHeaders,n=[],r={};t.forEach((function(e){e.name.startsWith("VM-")?r[e.name.slice(3)]=e.value:n.push(e)}));var o=r.Verify;if(o){var i=f[o];i&&(delete r.Verify,p[e.requestId]=o,i.coreId=e.requestId,Object.keys(r).forEach((function(e){h.includes(e.toLowerCase())&&n.push({name:e,value:r[e]})})))}return{requestHeaders:n}}),{urls:["<all_urls>"],types:["xmlhttprequest"]},["blocking","requestHeaders"]);var w=/\.(user|meanOs)\.js([?#]|$)/,y=["^https://greasyfork.org/scripts/[^/]*/code/[^/]*?\\.user\\.js([?#]|$)","^https://openuserjs.org/install/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://github.com/[^/]*/[^/]*/raw/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://gist.github.com/.*?/[^/]*?.user.js([?#]|$)"].map((function(e){return new RegExp(e)})),S=["//(?:(?:gist.|)github.com|greasyfork.org|openuserjs.org)/"].map((function(e){return new RegExp(e)})),j={};function E(e){return e.split("&").reduce((function(e,t){var n=t.split("=");return e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]),e}),{})}function T(e){return Object.keys(e).map((function(t){return`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`})).join("&")}browser.webRequest.onBeforeRequest.addListener((function(e){var t=e.url;if("GET"===e.method&&w.test(t)&&!j[t]&&(y.some((function(e){return e.test(t)}))||!S.some((function(e){return e.test(t)}))))return Promise.all([Object(d.r)(t).catch((function(){return{data:""}})),e.tabId<0?Promise.resolve():browser.tabs.get(e.tabId)]).then((function(e){var n=l()(e,2),r=n[0].data,o=n[1];Object(c.f)(r).name?O({code:r,url:t,from:o&&o.url}):(j[t]||(j[t]={timer:setTimeout((function(){delete j[t]}),1e4)}),o&&o.id&&browser.tabs.update(o.id,{url:t}))})),{redirectUrl:"javascript:history.back()"}}),{urls:["<all_urls>"],types:["main_frame"]},["blocking"]);var k=n(31),A=n(15)},21:function(e,t,n){"use strict";n.d(t,"c",(function(){return L})),n.d(t,"e",(function(){return C})),n.d(t,"b",(function(){return S})),n.d(t,"a",(function(){return I})),n.d(t,"d",(function(){return P}));var r,o=n(12),i=n.n(o),a=n(9),c=n.n(a),s=n(0),u=n(1),l=n(2),d=n(5),f={update:e=>Object(d.o)(e),list:()=>Object(d.k)(),get:e=>Object(d.j)(e),remove:e=>Object(d.p)(e)},p=[],h=[],m={},v=Object(s.d)(C,36e5),g=Promise.resolve();function b(e){var t=e.name,n=e.uri;return n?function(e){return"vm-"+encodeURIComponent(e)}(n):t}function O(e){return/^vm-/.test(e)}function w(e){return decodeURIComponent(e.slice(3))}function y(e,t,n){var r=t||e[0];function o(){return r}return{get:o,set:function(t){return e.includes(t)?(r=t,n&&n()):console.warn("Invalid state:",t),o()},is:function(e){return(Array.isArray(e)?e:[e]).includes(r)}}}function S(){return p.map((function(e){var t=m[e];return{name:t.name,displayName:t.displayName,authState:t.authState.get(),syncState:t.syncState.get(),lastSync:t.config.get("meta",{}).lastSync,progress:t.progress}}))}function j(e){var t=function(){this.initialize()};return t.prototype=e,t.extend=E,t}function E(e){return j(Object.assign(Object.create(this.prototype),e))}var T=Object(s.d)((function(){Object(l.s)({cmd:"UpdateSync",data:S()})})),k=j({name:"base",displayName:"BaseService",delayTime:1e3,urlPrefix:"",metaFile:"AceScript",initialize(){var e=this;this.progress={finished:0,total:0},this.config=function(e){function t(t){var n=Object(s.q)(t);return n.unshift("services",e),n}return{get:function(e,n){return r.get(t(e),n)},set:function(e,n){if("object"==typeof e){var o=e;Object.keys(o).forEach((function(e){r.set(t(e),o[e])}))}else r.set(t(e),n)},clear:function(){r.set(t(),{})}}}(this.name),this.authState=y(["idle","initializing","authorizing","authorized","unauthorized","error"],null,T),this.syncState=y(["idle","ready","syncing","error"],null,T),this.lastFetch=Promise.resolve(),this.startSync=this.syncFactory();var t=Object(l.i)();["on","off","fire"].forEach((function(n){e[n]=function(){t[n].apply(t,arguments)}}))},log(){var e;(e=console).log.apply(e,arguments)},syncFactory(){var e,t,n=this,r=function(){return n.authState.is("authorized")&&R()===n.name};return function(){return e||function(){if(!r())return Promise.resolve();n.log("Ready to sync:",n.displayName),n.syncState.set("ready"),g=g.then((function(){return new Promise((function(e){(t=Object(s.d)(e,1e4))()}))})).then((function(){if(r())return n.sync();n.syncState.set("idle")})).catch((function(e){console.error(e)})).then((function(){e=null,t=null})),e=g}(),t&&t(),e}},prepareHeaders(){this.headers={}},prepare(){var e=this;return this.authState.set("initializing"),(this.initToken()?Promise.resolve(this.user()):Promise.reject({type:"unauthorized"})).then((function(){e.authState.set("authorized")}),(function(t){throw t&&"unauthorized"===t.type?e.authState.set("unauthorized"):(console.error(t),e.authState.set("error")),e.syncState.set("idle"),t}))},checkSync(){var e=this;return this.prepare().then((function(){return e.startSync()}))},user:s.p,handleMetaError(e){throw e},getMeta(){var e=this;return this.get({name:this.metaFile}).then((function(e){return JSON.parse(e)})).catch((function(t){return e.handleMetaError(t)}))},initToken(){this.prepareHeaders();var e=this.config.get("token");return this.headers.Authorization=e?"Bearer "+e:null,!!e},loadData(e){var t=this,n=this.progress,r=e.delay;null==r&&(r=this.delayTime);var o=Promise.resolve();return r&&(o=this.lastFetch.then((function(e){return new Promise((function(t){var n=r-(Date.now()-e);n>0?setTimeout(t,n):t()}))})).then((function(){return Date.now()})),this.lastFetch=o),n.total+=1,T(),o.then((function(){var n=e.prefix;null==n&&(n=t.urlPrefix);var r=Object.assign({},t.headers,e.headers),o=e.url;return o.startsWith("/")&&(o=n+o),Object(s.r)(o,{headers:r,method:e.method,body:e.body,responseType:e.responseType})})).then((function(e){return{data:e.data}}),(function(e){return{error:e}})).then((function(e){var t=e.data,r=e.error;return n.finished+=1,T(),r?Promise.reject(r):t}))},getLocalData:()=>f.list(),getSyncData(){var e=this;return this.getMeta().then((function(t){return Promise.all([{name:e.metaFile,data:t},e.list(),e.getLocalData()])}))},sync(){var e=this;return this.progress={finished:0,total:0},this.syncState.set("syncing"),this.prepare().then((function(){return e.getSyncData()})).then((function(t){var n=c()(t,3),r=n[0],o=n[1],a=n[2],p=r.data,h=p.info||{},m=p.timestamp||0,v=!m||Object.keys(h).length!==o.length,g=Date.now(),b=Object(l.j)("lastModified"),O={},w=e.config.get("meta",{}),y=!w.timestamp,S=y||m>w.timestamp;e.log("First sync:",y),e.log("Outdated:",S,"(","local:",w.timestamp,"remote:",m,")");var j=[],E=[],T=[],k=[],A=[];p.info=o.reduce((function(e,t){O[t.uri]=t;var n=h[t.uri];return n||(n={},v=!0),e[t.uri]=n,n.modified||(n.modified=g,v=!0),e}),{}),a.forEach((function(e){var t=e.props,n=t.uri,r=t.position,o=t.lastModified,i=p.info[n];if(i){var a=O[n];y||!o||i.modified>o?j.push({local:e,remote:a,info:i}):(i.modified<o&&(E.push({local:e,remote:a}),i.modified=o,v=!0),i.position!==r&&(i.position&&b<=m?A.push({local:e,remote:a,info:i}):(i.position=r,v=!0))),delete O[n]}else y||!S||o>m?E.push({local:e}):k.push({local:e})})),Object.keys(O).forEach((function(e){var t=O[e],n=p.info[e];S?j.push({remote:t,info:n}):T.push({remote:t})}));var R=[].concat(i()(j.map((function(t){var n=t.remote,r=t.info;return e.log("Download script:",n.uri),e.get(n).then((function(e){var t=function(e){var t={};try{var n=JSON.parse(e);t.code=n.code,2===n.version?(t.config=n.config,t.custom=n.custom,t.props=n.props):1===n.version&&n.more&&(t.custom=n.more.custom,t.config=Object(u.c)({enabled:n.more.enabled,shouldUpdate:n.more.update}),t.props=Object(u.c)({lastUpdated:n.more.lastUpdated}))}catch(n){t.code=e}return t}(e);if(t.code){r.modified&&Object(u.d)(t,"props.lastModified",r.modified);var n=+r.position;return n&&(t.position=n),!Object(l.j)("syncScriptStatus")&&t.config&&delete t.config.enabled,f.update(t)}}))}))),i()(E.map((function(t){var n=t.local,r=t.remote;return e.log("Upload script:",n.props.uri),f.get(n.props.id).then((function(t){var o=function(e,t,n){var r;return 2===t?r={version:t,custom:e.custom,config:e.config,props:Object(u.b)(e.props,["lastUpdated"])}:1===t&&(r={version:t,more:{custom:e.custom,enabled:e.config.enabled,update:e.config.shouldUpdate,lastUpdated:e.props.lastUpdated}}),Object.assign(r,n)}(n,1,{code:t});return p.info[n.props.uri]={modified:n.props.lastModified,position:n.props.position},v=!0,e.put(Object.assign({},r,{uri:n.props.uri}),JSON.stringify(o))}))}))),i()(T.map((function(t){var n=t.remote;return e.log("Remove remote script:",n.uri),delete p.info[n.uri],v=!0,e.remove(n)}))),i()(k.map((function(t){var n=t.local;return e.log("Remove local script:",n.props.uri),f.remove(n.props.id)}))),i()(A.map((function(e){var t=e.local,n=e.info,r={};return n.position&&(r.props={position:n.position}),Object(d.r)(t.props.id,r)}))));return R.push(Promise.all(R).then((function(){return Object(d.q)()})).then((function(e){if(e)return v=!0,f.list().then((function(e){e.forEach((function(e){var t=p.info[e.props.uri];t&&(t.position=e.props.position)}))}))}))),R.push(Promise.all(R).then((function(){var t=[];return v&&(p.timestamp=Date.now(),t.push(e.put(r,JSON.stringify(p)))),w.timestamp=p.timestamp,w.lastSync=Date.now(),e.config.set("meta",w),Promise.all(t)}))),Promise.all(R.map((function(e){return e.then(s.p,(function(e){return e||!0}))}))).then((function(e){return e.filter(Boolean)})).then((function(e){if(e.length)throw e}))})).then((function(){e.syncState.set("idle")}),(function(t){e.syncState.set("error"),e.log("Failed syncing:",e.name),e.log(t)}))}});function A(e){h.push(e)}function R(){return r.get("current")}function x(e){return m[e||R()]}function L(){r||(r=function(){function e(e,t){var n=Object(s.q)(e);n.unshift("sync"),Object(l.u)(n,t)}var t;return(t=Object(l.j)("sync"))&&t.services||e([],t={services:{}}),{get:function(e,t){var n=Object(s.q)(e);return n.unshift("sync"),Object(l.j)(n,t)},set:e}}(),h.forEach((function(e){var t=new e,n=t.name;p.push(n),m[n]=t})));var e=x();e&&e.checkSync()}function C(){var e=x();return e&&Promise.resolve(function(e){if(!e.syncState.is(["ready","syncing"]))return e.authState.is(["idle","error"])?e.checkSync():e.authState.is("authorized")?e.startSync():void 0}(e)).then(v)}function I(){var e=x();e&&e.authorize()}function P(){var e=x();e&&e.revoke()}Object(l.l)((function(e){Object(u.a)(e,"sync.current")&&L()}));var U="f0q12zup2uys5w8",_="https://violentmonkey.github.io/auth_dropbox.html";function N(e){return{size:e.size,uri:w(e.name)}}A(k.extend({name:"dropbox",displayName:"Dropbox",user(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/users/get_current_account"}).catch((function(e){return 401===e.status?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})}))},handleMetaError(e){if(409===e.status)return{};throw e},list(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/list_folder",body:{path:""},responseType:"json"}).then((function(e){return e.entries.filter((function(e){return"file"===e[".tag"]&&O(e.name)})).map(N)}))},get(e){var t=b(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/download",headers:{"Dropbox-API-Arg":JSON.stringify({path:"/"+t})}})},put(e,t){var n=b(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/upload",headers:{"Dropbox-API-Arg":JSON.stringify({path:"/"+n,mode:"overwrite"}),"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(N)},remove(e){var t=b(e);return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/delete",body:{path:"/"+t},responseType:"json"}).then(N)},authorize(){var e={response_type:"token",client_id:U,redirect_uri:_},t="https://www.dropbox.com/oauth2/authorize?"+Object(l.f)(e);browser.tabs.create({url:t})},authorized(e){var t=Object(l.o)(e);t.access_token&&this.config.set({uid:t.uid,token:t.access_token})},checkAuth(e){var t=_+"#";if(e.startsWith(t))return this.authorized(e.slice(t.length)),this.checkSync(),!0},revoke(){return this.config.set({uid:null,token:null}),this.prepare()}}));var M=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0Ijoiajl4M09WRXRIdmhpSEtEV09HcXV5TWZaS2s5NjA0MEgifQ==")),D=Object.assign({client_id:"000000004418358A",redirect_uri:"https://violentmonkey.github.io/auth_onedrive.html"},M);function V(e){return{size:e.size,uri:w(e.name)}}A(k.extend({name:"onedrive",displayName:"OneDrive",urlPrefix:"https://api.onedrive.com/v1.0",refreshToken(){var e=this,t=this.config.get("refresh_token");return this.authorized({refresh_token:t,grant_type:"refresh_token"}).then((function(){return e.prepare()}))},user(){var e=this,t=function(){return e.loadData({url:"/drive",responseType:"json"})};return t().catch((function(n){if(401===n.status)return e.refreshToken().then(t);throw n})).catch((function(e){return 400===e.status&&"invalid_grant"===Object(u.a)(e,"data.error")?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})}))},handleMetaError(e){var t=this;if(404===e.status){var n=e.xhr.getResponseHeader("WWW-Authenticate")||"";return/^Bearer realm="OneDriveAPI"/.test(n)?this.refreshToken().then((function(){return t.getMeta()})):{}}throw e},list(){return this.loadData({url:"/drive/special/approot/children",responseType:"json"}).then((function(e){return e.value.filter((function(e){return e.file&&O(e.name)})).map(V)}))},get(e){var t=this,n=b(e);return this.loadData({url:"/drive/special/approot:/"+encodeURIComponent(n),responseType:"json"}).then((function(e){return t.loadData({url:e["@content.downloadUrl"],delay:!1})}))},put(e,t){var n=b(e);return this.loadData({method:"PUT",url:`/drive/special/approot:/${encodeURIComponent(n)}:/content`,headers:{"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(V)},remove(e){var t=b(e);return this.loadData({method:"DELETE",url:"/drive/special/approot:/"+encodeURIComponent(t)}).catch(s.p)},authorize(){var e={client_id:D.client_id,scope:"onedrive.appfolder wl.offline_access",response_type:"code",redirect_uri:D.redirect_uri},t="https://login.live.com/oauth20_authorize.srf?"+Object(l.f)(e);browser.tabs.create({url:t})},checkAuth(e){var t=this,n=D.redirect_uri+"?code=";if(e.startsWith(n))return this.authState.set("authorizing"),this.authorized({code:e.slice(n.length)}).then((function(){return t.checkSync()})),!0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://login.live.com/oauth20_token.srf",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object(l.f)(Object.assign({},{client_id:D.client_id,client_secret:D.client_secret,redirect_uri:D.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then((function(e){if(!e.access_token)throw e;t.config.set({uid:e.user_id,token:e.access_token,refresh_token:e.refresh_token})}))}}));var q=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0IjoiTjBEbTZJOEV3bkJaeE1xMUpuMHN3UER0In0=")),B=Object.assign({client_id:"590447512361-05hjbhnf8ua3iha55e5pgqg15om0cpef.apps.googleusercontent.com",redirect_uri:"https://violentmonkey.github.io/auth_googledrive.html",scope:"https://www.googleapis.com/auth/drive.appdata"},q),$={status:"UNAUTHORIZED"};function G(e){return{id:e.id,size:+e.size,uri:w(e.name)}}A(k.extend({name:"googledrive",displayName:"Google Drive",urlPrefix:"https://www.googleapis.com/drive/v3",refreshToken(){var e=this,t=this.config.get("refresh_token");return t?this.authorized({refresh_token:t,grant_type:"refresh_token"}).then((function(){return e.prepare()})):Promise.reject({type:"unauthorized"})},user(){var e=this,t=function(){return e.loadData({url:"https://www.googleapis.com/oauth2/v3/tokeninfo?"+Object(l.f)({access_token:e.config.get("token")}),responseType:"json"})};return t().then((function(t){return"online"===t.access_type?e.loadData({method:"POST",url:"https://accounts.google.com/o/oauth2/revoke?token="+e.config.get("token"),prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(){return Object(l.q)({title:"Sync Upgraded",body:"Please reauthorize access to your Google Drive to complete the upgradation."}),Promise.reject("Online access revoked.")})):t.scope!==B.scope?Promise.reject($):void 0})).catch((function(n){return n===$||400===n.status&&"Invalid Value"===Object(u.a)(n,"data.error_description")?e.refreshToken().then(t):Promise.reject({type:"error",data:n})}))},getSyncData(){var e=this;return this.loadData({url:"/files?"+Object(l.f)({spaces:"appDataFolder",fields:"files(id,name,size)"}),responseType:"json"}).then((function(t){var n,r=t.files.filter((function(t){return!!O(t.name)||(n||t.name!==e.metaFile?e.remove(t):n=t,!1)})).map(G).filter((function(t){return!!t.size||(e.remove(t),!1)})),o=n?G(n):{},i=e.get(o).then((function(e){return JSON.parse(e)})).catch((function(t){return e.handleMetaError(t)})).then((function(t){return Object.assign({},o,{data:t,uri:null,name:e.metaFile})}));return Promise.all([i,r,e.getLocalData()])}))},authorize(){var e={response_type:"code",access_type:"offline",client_id:B.client_id,redirect_uri:B.redirect_uri,scope:B.scope};this.config.get("refresh_token")||(e.prompt="consent");var t="https://accounts.google.com/o/oauth2/v2/auth?"+Object(l.f)(e);browser.tabs.create({url:t})},checkAuth(e){var t=this,n=B.redirect_uri+"?code=";if(e.startsWith(n))return this.authState.set("authorizing"),this.authorized({code:e.split("#")[0].slice(n.length)}).then((function(){return t.checkSync()})),!0},revoke(){return this.config.set({token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object(l.f)(Object.assign({},{client_id:B.client_id,client_secret:B.client_secret,redirect_uri:B.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then((function(e){if(!e.access_token)throw e;var n={token:e.access_token};e.refresh_token&&(n.refresh_token=e.refresh_token),t.config.set(n)}))},handleMetaError:()=>({}),list(){throw new Error("Not supported")},get(e){var t=e.id;return t?this.loadData({url:`/files/${t}?alt=media`}):Promise.reject()},put(e,t){var n=b(e),r=e.id,o=Object(s.j)("violentmonkey-is-great-"),i={"Content-Type":"multipart/related; boundary="+o},a=r?{name:n}:{name:n,parents:["appDataFolder"]},c=["--"+o,"Content-Type: application/json; charset=UTF-8","",JSON.stringify(a),"--"+o,"Content-Type: text/plain","",t,`--${o}--`,""].join("\r\n"),u=r?`https://www.googleapis.com/upload/drive/v3/files/${r}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";return this.loadData({url:u,body:c,headers:i,method:r?"PATCH":"POST"})},remove(e){var t=e.id;return this.loadData({method:"DELETE",url:"/files/"+t})}})),browser.tabs.onUpdated.addListener((function(e,t){var n;t.url&&(n=t.url,p.some((function(e){var t=m[e];return t.checkAuth&&t.checkAuth(n)})))&&browser.tabs.remove(e)}))},23:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return p})),n.d(t,"b",(function(){return h})),n.d(t,"e",(function(){return m})),n.d(t,"a",(function(){return v})),n.d(t,"d",(function(){return g}));var r=n(0),o=n(1),i=n(31),a={isApplied:!0,autoUpdate:!0,lastUpdate:0,lastModified:0,showBadge:"unique",exportValues:!0,closeAfterInstall:!1,trackLocalFile:!1,autoReload:!1,features:null,blacklist:null,syncScriptStatus:!0,sync:null,customCSS:null,importSettings:!0,notifyUpdates:!1,version:null,filters:{sort:"exec"},editor:{lineWrapping:!1,indentUnit:2},scriptTemplate:"// ==UserScript==\n// @name New Script\n// @namespace AceScript Scripts\n// @match {{url}}\n// @grant none\n// ==/UserScript==\n"},c={},s=Object(r.l)(),u=Object(r.d)((function(){s.fire(c),c={}}),100),l={},d=!1,f=browser.storage.local.get("options").then((function(t){var n=t.options;if(n&&"object"==typeof n&&(l=n),e.env.DEBUG&&console.log("options:",l),!Object(o.a)(l,"version")){e.env.DEBUG&&console.log("Upgrade options...");try{localStorage.length&&Object.keys(a).forEach((function(t){var n=localStorage.getItem(t);if(n)try{n=JSON.parse(n)}catch(e){n=null}n&&(e.env.DEBUG&&console.log("Upgrade option:",t,n),m(t,n))}))}catch(e){}m("version",1)}})).then((function(){d=!0}));function p(e,t){var n=Object(r.q)(e),i=n[0],c=l[i];return null==c&&(c=a[i]),null==c&&(c=t),n.length>1?Object(o.a)(c,n.slice(1),t):c}function h(e){return Object(o.a)(a,e)}function m(t,n){if(d){var i=Object(r.q)(t),s=i.join("."),h=n,v=i[0];v in a&&(i.length>1&&(h=Object(o.d)(p(v),i.slice(1),n)),l[v]=h,browser.storage.local.set({options:l}),function(e,t){Object(o.d)(c,e,t),u()}(i,n),e.env.DEBUG&&console.log("Options updated:",s,n,l))}else f.then((function(){m(t,n)}))}function v(){return Object.keys(a).reduce((function(e,t){return e[t]=p(t),e}),{})}Object(i.b)(f);var g=s.hook}).call(this,n(16))},28:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return h})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return g})),n.d(t,"f",(function(){return b}));var r=n(0),o=(n(13),n(29));var i=n(5);i.d.on("scriptSaved",(function(e){Object(r.t)("news:scriptSaved: data",e),c()})),i.d.on("scriptRemoved",(function(e){Object(r.t)("news:scriptRemoved: data",e),c()})),i.d.on("scriptUpdated",(function(e){Object(r.t)("news:scriptUpdated: data",e),c()}));var a={config:{checkInterval:144e5,notificationBaseInterval:36e5,notificationIntervalAdjust:36e5,notificationMaxImpressions:10,notificationMaxSkip:2,notificationBaseSkipInterval:6048e5,notificationSkipIntervalAdjust:0,forceLocale:!1},initDone:!1,lastEngineVersion:0,news:{},installedScripts:{},excludeByScript:{},privacyOptInAccepted:!1};function c(){return Object(i.g)().then((function(e){a.installedScripts={},e.forEach((function(e){a.installedScripts[e]=1})),Object(r.t)("news:updateInstalledScripts",a.installedScripts)}))}function s(){return browser.storage.local.get("news").then((function(e){e&&e.news&&(a.news=JSON.parse(e.news))}))}function u(){var e={};return Object.keys(a.news).forEach((function(t){void 0!==a.news[t].read&&delete a.news[t].read,a.news[t].excludeScripts&&a.news[t].excludeScripts.forEach((function(n){void 0===e[n]&&(e[n]={});["skipCount","skipUpdatedAt","impressionCount","impressionUpdatedAt"].forEach((function(r){a.news[t][r]&&(e[n][r]=a.news[t][r])}))}))})),a.excludeByScript=e,Object(r.t)("updateExcludes: excludeByScript",e),Promise.resolve()}function l(){u(),browser.storage.local.set({news:JSON.stringify(a.news)})}function d(){return null}function f(e,t){var n=t.skipCount||0;if(a.config.notificationMaxSkip>0&&n>=a.config.notificationMaxSkip)return Object(r.t)(`shouldShowNotification: max skip: id=${e} count=${n}`),!1;var o=t.impressionCount||0;if(a.config.notificationMaxImpressions>0&&o>=a.config.notificationMaxImpressions)return Object(r.t)(`shouldShowNotification: max impressions: id=${e} count=${o}`),!1;if(t.skipUpdatedAt){var i=t.skipUpdatedAt||0,c=Date.now()-i,s=a.config.notificationBaseSkipInterval+n*a.config.notificationSkipIntervalAdjust;if(c<s)return Object(r.t)(`shouldShowNotification: skip age: id=${e} age=${c} minAge=${s}`),!1}if(t.impressionUpdatedAt){var u=t.impressionUpdatedAt||0,l=Date.now()-u,d=a.config.notificationBaseInterval+o*a.config.notificationIntervalAdjust;if(l<d)return Object(r.t)(`shouldShowNotification: impression age: id=${e} age=${l} minAge=${d}`),!1}return!0}function p(){return a.initDone_?Promise.resolve():(a.initDone_=!0,Object(o.a)().then((function(e){a.privacyOptInAccepted=e.accepted})).then(s).then(c).then(u).then(d).catch((function(e){Object(r.t)("news: init failed: err="+e)})))}function h(e){var t=[];return Object.keys(a.news).forEach((function(n){var o=!1;if(a.news[n].includes&&a.news[n].includes.length)for(var i=0;i<a.news[n].includes.length;i+=1){if(new RegExp(a.news[n].includes[i]).test(e)){Object(r.t)(`getNewsForUrl: got includes match: re=${a.news[n].includes[i]} url=${e}`),o=!0;break}}else if(a.news[n].excludes&&a.news[n].excludes.length){o=!0;for(var c=0;c<a.news[n].excludes.length;c+=1){if(new RegExp(a.news[n].excludes[c]).test(e)){Object(r.t)(`getNewsForUrl: got excludes match: re=${a.news[n].excludes[c]} url=${e}`),o=!1;break}}}if(o){if(!f(n,a.news[n]))return void Object(r.t)(`getNewsForUrl: skip: id=${n} url=${e}`);if(a.news[n].excludeBasedOnOther&&a.news[n].excludeScripts&&a.news[n].excludeScripts.length)for(var s=0;s<a.news[n].excludeScripts.length;s+=1){var u=a.news[n].excludeScripts[s];if(a.excludeByScript[u]&&!f(n,a.excludeByScript[u]))return void Object(r.t)(`getNewsForUrl: skip (other): id=${n} scriptId=${u}`)}var l=!0;if(a.news[n].excludeScripts&&a.news[n].excludeScripts.length){Object(r.t)("getNewsForUrl: installedScripts",a.installedScripts);for(var d=0;d<a.news[n].excludeScripts.length;d+=1)if(1===a.installedScripts[a.news[n].excludeScripts[d]]){Object(r.t)(`getNewsForUrl: skip user notify, got installed script: id=${n} script=${a.news[n].excludeScripts[d]}`),l=!1;break}}l&&t.push({id:n,title:a.news[n].title,text:a.news[n].text,btnUrl:a.news[n].btnUrl,btnTitle:a.news[n].btnTitle})}})),t}function m(e){a.news[e]&&(Object(r.t)("news:onInstallButtonClicked: id="+e),a.news[e].impressionUpdatedAt=Date.now(),l())}function v(e){a.news[e]&&(Object(r.t)("news:onSkipButtonClicked: id="+e),void 0===a.news[e].skipCount&&(a.news[e].skipCount=0),a.news[e].skipUpdatedAt=Date.now(),a.news[e].skipCount+=1,l())}function g(e){a.news[e]&&(void 0===a.news[e].impressionCount&&(a.news[e].impressionCount=0),a.news[e].impressionUpdatedAt=Date.now(),a.news[e].impressionCount+=1,l())}function b(e){Object.assign(a.config,e)}},31:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var r=[];function o(e){r.push(e)}function i(){return Promise.all(r.map((function(e){return"function"==typeof e?e():e}))).then((function(){}))}},36:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return d})),n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return b}));var r=n(30),o=n(19),i=n(23);r.c(!0);var a=/(.*?):\/\/([^/]*)\/(.*)/,c=[];Object(i.d)((function(e){"blacklist"in e&&b(e.blacklist||"")}));var s=/^https?$/i;function u(e,t){return t.some((function(t){var n="re:"+t,r=o.a.get(n);return r?o.a.hit(n,6e4):(r=h(t),o.a.put(n,r,6e4)),r.test(e)}))}function l(e,t){return t.some((function(t){var n="match:"+t,r=o.a.get(n);return r?o.a.hit(n,6e4):(r=m(t),o.a.put(n,r,6e4)),r.test(e)}))}function d(e,t){var n=t.custom,r=t.meta,o=f(n.origMatch&&r.match,n.match),i=f(n.origInclude&&r.include,n.include),a=f(n.origExclude&&r.exclude,n.exclude),c=f(n.origExcludeMatch&&r.excludeMatch,n.excludeMatch),s=!o.length&&!i.length;return s=(s=(s=(s=s||l(e,o))||u(e,i))&&!l(e,c))&&!u(e,a)}function f(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return t?e.concat(t):e}),[])}function p(e){return`^${e.replace(/([.?+[\]{}()|^$])/g,"\\$1").replace(/\*/g,".*?")}$`}function h(e){if(e.length>1&&"/"===e[0]&&"/"===e[e.length-1])return new RegExp(e.slice(1,-1));var t=p(e),n=new RegExp(t),o=[function(e){return n.test(e)}];if(r.d()&&e.includes(".tld/")){var i=t.replace("\\.tld/","((?:\\.\\w+)+)/");o.push((function(e){var t=e.match(i);if(t){var n=t[1].slice(1);if(r.b(n)===n)return!0}return!1}))}return{test:function(e){return o.some((function(t){return t(e)}))}}}function m(e){var t;if("<all_urls>"===e)t=function(){return!0};else{var n=e.match(a);if(n){var r=function(e){var t=new RegExp(p(e));return function(n){if("*"===e)return 1;if(e===n)return 1;if(/^\*\.[^*]*$/.test(e)){if(e.slice(2)===n)return 1;if(t.test(n))return 1}return 0}}(n[2]),o=function(e){var t=e.indexOf("#"),n=e.indexOf("?"),r=p(e);n>t&&(n=-1),n<0&&t<0?r=r.slice(0,-1)+"(?:[?#]|$)":t<0&&(r=r.slice(0,-1)+"(?:#|$)");var o=new RegExp(r);return function(e){return o.test(e)}}(n[3]);t=function(e){var t=e.match(a);return!!n&&!!t&&function(e,t){return e===t||"*"===e&&s.test(t)?1:0}(n[1],t[1])&&r(t[2])&&o(t[3])}}else t=function(){return!1}}return{test:t}}function v(e,t){if(t.startsWith(e))return t.slice(e.length).trim()}function g(e){for(var t=0;t<c.length;t+=1){var n=c[t],r=n.test,o=n.reject;if(r(e))return o}}function b(t){var n=null==t?Object(i.c)("blacklist"):t;e.env.DEBUG&&console.info("Reset blacklist:",n),c=(Array.isArray(n)?n:(n||"").split("\n")).map((function(e){var t=e.trim();if(!t||t.startsWith("#"))return null;var n=v("@include ",t);if(n)return{test:h(n).test,reject:!1};var r=v("@match ",t);if(r)return{test:m(r).test,reject:!1};var o=v("@exclude ",t);return o?{test:h(o).test,reject:!0}:t.indexOf("/")<0?{test:m(`*://${t}/*`).test,reject:!0}:{test:m(t).test,reject:!0}})).filter(Boolean)}}).call(this,n(16))},38:function(e,t,n){"use strict";n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return f}));var r,o,i=n(0),a=n(5),c={},s={};function u(e,t){p();var n=t.key,o=t.value;r||(r={});var i=r[e];i||(i={},r[e]=i),i[n]=o||null}function l(e,t){return Object(a.b)(e,t).then(m)}function d(e){var t=s[e];t&&(Object.keys(t).forEach((function(t){var n=c[t];n&&delete n[e]})),delete s[e])}function f(e,t){var n=s[e];n||(n={},s[e]=n),t.forEach((function(t){n[t]=1;var r=c[t];r||(r={},c[t]=r),r[e]=1}))}function p(){o||(o=Promise.resolve().then(h))}function h(){var e=r;r=null;var t=Object.keys(e);Object(a.m)(t).then((function(n){return t.forEach((function(t){var r=n[t]||{};n[t]=r;var o=e[t]||{};Object.keys(o).forEach((function(e){var t=o[e];t?r[e]=t:delete r[e]}))})),Object(a.c)(n)})).then(m).catch((function(e){console.error("Values error:",e)})).then((function(){o=null,r&&p()}))}function m(e){if(e){var t=Object.keys(e).reduce((function(e,t){return Object.assign(e,c[t])}),{});Object.keys(t).forEach((function(t){browser.tabs.sendMessage(+t,{cmd:"UpdatedValues",data:e}).catch(i.p)}))}}browser.tabs.onRemoved.addListener((function(e){d(e)}))},44:function(e,t,n){"use strict";function r(){var e={};return{on:function(t,n){var r=e[t];r||(r=[],e[t]=r);r.push(n)},off:function(t,n){var r=e[t];if(r){var o=r.indexOf(n);o>=0&&r.splice(o,1)}},fire:function(t,n){var r=e[t];r&&r.forEach((function(e){e(n,t)}))}}}n.d(t,"a",(function(){return r}))},5:function(e,t,n){"use strict";(function(e){n.d(t,"d",(function(){return g})),n.d(t,"q",(function(){return E})),n.d(t,"h",(function(){return T})),n.d(t,"k",(function(){return k})),n.d(t,"g",(function(){return A})),n.d(t,"i",(function(){return R})),n.d(t,"j",(function(){return x})),n.d(t,"m",(function(){return L})),n.d(t,"c",(function(){return C})),n.d(t,"b",(function(){return I})),n.d(t,"l",(function(){return P})),n.d(t,"e",(function(){return U})),n.d(t,"a",(function(){return _})),n.d(t,"p",(function(){return N})),n.d(t,"n",(function(){return M})),n.d(t,"r",(function(){return V})),n.d(t,"f",(function(){return q})),n.d(t,"o",(function(){return B})),n.d(t,"s",(function(){return G}));var r=n(12),o=n.n(r),i=n(9),a=n.n(i),c=n(0),s=n(1),u=n(11),l=n(36),d=n(31),f=n(96),p=n(23),h=n(15),m=n(104),v=n(44),g=Object(v.a)();function b(e){var t={};return function(n){var r=t[n];if(!r){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];r=e.call.apply(e,[this,n].concat(i)).catch((function(e){console.error("Error fetching: "+n,e)})).then((function(){delete t[n]})),t[n]=r}return r}}var O,w={},y={base:{prefix:"",getKey(e){return`${this.prefix}${e}`},getOne(e){var t=this.getKey(e);return browser.storage.local.get(t).then((function(e){return e[t]}))},getMulti(e,t){var n=this;return browser.storage.local.get(e.map((function(e){return n.getKey(e)}))).then((function(r){var o={};return e.forEach((function(e){o[e]=r[n.getKey(e)]||t})),o}))},set(e,t){return e?browser.storage.local.set({[this.getKey(e)]:t}):Promise.resolve()},remove(e){return e?browser.storage.local.remove(this.getKey(e)):Promise.resolve()},removeMulti(e){var t=this;return browser.storage.local.remove(e.map((function(e){return t.getKey(e)})))}}};function S(e){return+e||0}function j(){var e=[];w.scripts.forEach((function(t,n){var r=n+1;Object(s.a)(t,"props.position")!==r&&(Object(s.d)(t,"props.position",r),e.push(t)),void 0===t.custom.origInclude&&(t.custom=Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},t.custom),e.includes(t)||e.push(t))})),w.storeInfo.position=w.scripts.length;var t=e.length;return t?y.script.dump(e).then((function(){return Object(p.e)("lastModified",Date.now()),t})):Promise.resolve()}function E(){return w.scripts.sort((function(e,t){var n=[e,t].map((function(e){return S(Object(s.a)(e,"props.position"))})),r=a()(n,2);return r[0]-r[1]})),j().then((function(e){return Object(h.c)({cmd:"ScriptsUpdated"}),e}))}function T(e){var t;if(w.scripts)if(e.id)t=w.scriptMap[e.id];else{var n=e.uri||Object(u.b)({meta:e.meta,id:"@@should-have-name"});t=w.scripts.find((function(e){return n===Object(s.a)(e,"props.uri")}))}return Promise.resolve(t)}function k(){return Promise.resolve(w.scripts).then((function(e){return e.filter((function(e){return!e.config.removed}))}))}function A(){return new Promise((function(e){var t=[];k().then((function(n){n&&n.forEach((function(e){t.push(e.props.scriptId)})),e(t)}))}))}function R(e){return Promise.all(e.map((function(e){return T({id:e})}))).then((function(e){return e.filter(Boolean)}))}function x(e){return y.code.getOne(e)}function L(e){return y.value.getMulti(e)}function C(t){return e.env.DEBUG&&console.info("Update value stores",t),y.value.dump(t).then((function(){return t}))}function I(e,t){return(e.id?Promise.resolve(e.id):T(e).then((function(e){return Object(s.a)(e,"props.id")}))).then((function(e){if(e)return C({[e]:t})}))}function P(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(l.b)(e)?[]:w.scripts.filter((function(n){return!n.config.removed&&(!!Object(l.c)(e,n)&&!("noframes"in n.meta&&!t))})),r={},o={};n.forEach((function(e){if(e.config.enabled){e.custom.pathMap||$(e);var t=e.custom.pathMap;e.meta.require.forEach((function(e){r[t[e]||e]=1})),Object.values(e.meta.resources).forEach((function(e){o[t[e]||e]=1}))}}));var i=n.filter((function(e){return e.config.enabled})),c={GM_getValue:1,GM_setValue:1,GM_listValues:1,GM_deleteValue:1},u=i.filter((function(e){var t=Object(s.a)(e,"meta.grant");return t&&t.some((function(e){return c[e]}))}));return Promise.all([y.require.getMulti(Object.keys(r)),y.cache.getMulti(Object.keys(o)),y.value.getMulti(u.map((function(e){return e.props.id})),{}),y.code.getMulti(i.map((function(e){return e.props.id})))]).then((function(e){var t=a()(e,4),r=t[0],o=t[1],i=t[2],c=t[3];return{scripts:n,require:r,cache:o,values:i,code:c}}))}function U(){var e={},t=w.scripts;return t.forEach((function(t){var n=Object(s.a)(t,"meta.icon");if(Object(c.n)(n)){var r=(Object(s.a)(t,"custom.pathMap")||{})[n]||n;e[r]=1}})),y.cache.getMulti(Object.keys(e)).then((function(e){return{scripts:t,cache:e}}))}function _(){var e=w.scripts.filter((function(e){return e.config.removed}));if(e.length){w.scripts=w.scripts.filter((function(e){return!e.config.removed}));var t=e.map((function(e){return e.props.id}));y.script.removeMulti(t),y.code.removeMulti(t),y.value.removeMulti(t)}return Promise.resolve(e.length)}function N(e){var t=null,n=w.scripts.findIndex((function(t){return e===Object(s.a)(t,"props.id")}));return n>=0&&(t=w.scripts[n].props.scriptId,w.scripts.splice(n,1),y.script.remove(e),y.code.remove(e),y.value.remove(e)),t&&g.fire("scriptRemoved",t),Object(h.c)({cmd:"RemoveScript",data:e}),Promise.resolve()}function M(e,t){var n=w.scripts.findIndex((function(t){return e===Object(s.a)(t,"props.id")})),r=t>0?1:-1,i=n,a=n+t,c=Math.min(i,a),u=Math.max(i,a),l=w.scripts.slice(c,u+1);return r>0?l.push(l.shift()):l.unshift(l.pop()),w.scripts=[].concat(o()(w.scripts.slice(0,c)),o()(l),o()(w.scripts.slice(u+1))),j()}function D(e,t){var n=e.config||{};n.enabled=S(n.enabled),n.shouldUpdate=S(n.shouldUpdate);var r,o=e.props||{};if(o.id?r=w.scriptMap[o.id]:(w.storeInfo.id+=1,o.id=w.storeInfo.id),o.uri=Object(u.b)(e),o.scriptId=Object(u.d)(e),o.uuid=o.uuid||`${(o.id+280880802).toString(16).slice(-8)}-${Object(c.i)()}-${Object(c.i)()}-${Object(c.i)()}-${Object(c.i)()}${Object(c.i)()}${Object(c.i)()}`,w.scripts.some((function(e){var t=e.props||{};return o.id!==t.id&&o.uri===t.uri})))throw Object(c.k)("msgNamespaceConflict");if(r){e.config=Object.assign({},r.config,n),e.props=Object.assign({},r.props,o);var i=w.scripts.indexOf(r);w.scripts[i]=e}else o.position?w.storeInfo.position<o.position&&(w.storeInfo.position=o.position):(w.storeInfo.position+=1,o.position=w.storeInfo.position),e.config=n,e.props=o,w.scripts.push(e);return Promise.all([y.script.dump(e),y.code.set(o.id,t)]).then((function(){g.fire("scriptSaved",o.scriptId)}))}function V(e,t){var n=w.scriptMap[e];return n?(n.props=Object.assign({},n.props,t.props),n.config=Object.assign({},n.config,t.config),g.fire("scriptUpdated",n.props.scriptId),y.script.dump(n)):Promise.reject()}function q(e,t){var n=e.filter((function(e){var t=w.scriptMap[e];return t&&!t.config.removed}));return Promise.all([Promise.all(n.map((function(e){return T({id:e})}))),y.code.getMulti(n)]).then((function(n){var r=a()(n,2),o=r[0],i=r[1],c={};return c.items=o.map((function(e){return{script:e,code:i[e.props.id]}})),t?y.value.getMulti(e).then((function(e){return c.values=e,c})):c}))}y.script=Object.assign({},y.base,{prefix:"scr:",dump:(O=function(e){var t=this,n={};return e.forEach((function(e){n[t.getKey(e.props.id)]=e,w.scriptMap[e.props.id]=e})),browser.storage.local.set(n).then((function(){return e}))},function(e){var t=Array.isArray(e)?e:[e];return(t=t.filter(Boolean)).length?O.call(this,t):Promise.resolve()})}),y.code=Object.assign({},y.base,{prefix:"code:"}),y.value=Object.assign({},y.base,{prefix:"val:",dump(e){var t=this,n={};return Object.keys(e).forEach((function(r){var o=e[r];n[t.getKey(r)]=o})),browser.storage.local.set(n)}}),y.require=Object.assign({},y.base,{prefix:"req:",fetch:b((function(e){var t=this;return Object(c.r)(e).then((function(n){var r=n.data;return t.set(e,r)}))}))}),y.cache=Object.assign({},y.base,{prefix:"cac:",fetch:b((function(e,t){var n=this;return Object(c.r)(e,{responseType:"arraybuffer"}).then((function(r){var o=r.data,i=(r.xhr.getResponseHeader("content-type")||"").split(";")[0],a={contentType:i,buffer:o,blob:function(e){return new Blob([o],Object.assign({type:i},e))},string:function(){return Object(c.b)(o)},base64:function(){return window.btoa(a.string())}};return(t?Promise.resolve(t(a)):Promise.resolve()).then((function(){return n.set(e,`${i},${a.base64()}`)}))}))}))}),Object(d.b)(browser.storage.local.get("version").then((function(e){var t=e.version,n=browser.runtime.getManifest().version;return(t?Promise.resolve():Object(f.a)()).then((function(){if(n!==t)return browser.storage.local.set({version:n})}))})).then((function(){return browser.storage.local.get()})).then((function(t){var n=[],r={id:0,position:0};return Object.keys(t).forEach((function(e){var o=t[e];e.startsWith("scr:")&&(n.push(o),r.id=Math.max(r.id,S(Object(s.a)(o,"props.id"))),r.position=Math.max(r.position,S(Object(s.a)(o,"props.position"))))})),Object.assign(w,{scripts:n,storeInfo:r,scriptMap:n.reduce((function(e,t){return e[t.props.id]=t,e}),{})}),e.env.DEBUG&&console.log("store:",w),E()})));function B(e){var t=e.id,n=e.code,r=e.message,o=e.isNew,i=e.config,a=e.custom,l=e.props,d=e.update,f=Object(u.f)(n);if(!f.name)return Promise.reject(Object(c.k)("msgInvalidScript"));var p={cmd:"UpdateScript",data:{update:{message:null==r?Object(c.k)("msgUpdated"):r||""}}};return T({id:t,meta:f}).then((function(t){var r;if(t){if(o)throw Object(c.k)("msgNamespaceConflict");r=Object.assign({},t)}else{var d=Object(u.e)();r=d.script,p.cmd="AddScript",p.data.isNew=!0,p.data.update.message=Object(c.k)("msgInstalled")}r.config=Object.assign({},r.config,i,{removed:0}),r.custom=Object.assign({},r.custom,a),r.props=Object.assign({},r.props,{lastModified:Date.now(),lastUpdated:Date.now()},l),r.meta=f,f.homepageURL||r.custom.homepageURL||!Object(c.n)(e.from)||(r.custom.homepageURL=e.from),Object(c.n)(e.url)&&(r.custom.lastInstallURL=e.url);var h=+e.position;return h&&Object(s.d)(r,"props.position",h),$(r,e.url),D(r,n).then((function(){return r}))})).then((function(t){return function(e,t){var n=e.meta,r=e.custom.pathMap;if(n.require.forEach((function(e){var n=r[e]||e,o=Object(s.a)(t,["require",n]);o?y.require.set(n,o):y.require.fetch(n)})),Object.values(n.resources).forEach((function(e){var n=r[e]||e,o=Object(s.a)(t,["resources",n]);o?y.cache.set(n,o):y.cache.fetch(n)})),Object(c.n)(n.icon)){var o=r[n.icon]||n.icon;y.cache.fetch(o,(function(e){var t=e.blob;return new Promise((function(e,n){var r=t(),o=URL.createObjectURL(r),i=new Image,a=function(){return URL.revokeObjectURL(o)};i.onload=function(){a(),e()},i.onerror=function(){a(),n({type:"IMAGE_ERROR",url:o})},i.src=o}))}))}}(t,e),Object.assign(p.data.update,t,d),p.data.where={id:t.props.id},Object(h.c)(p),m.a.emit("scriptChanged",p.data),p}))}function $(e,t){var n=e.meta,r=t||e.custom.lastInstallURL,i=r?[].concat(o()(n.require),o()(Object.values(n.resources)),[n.icon]).reduce((function(e,t){if(t){var n=Object(c.g)(t,r);n!==t&&(e[t]=n)}return e}),{}):{};return e.custom.pathMap=i,i}function G(){var e={},t={},n={},r={},o=[[y.value,e],[y.cache,t],[y.require,n],[y.code,r]];return browser.storage.local.get().then((function(i){Object.keys(i).forEach((function(e){o.some((function(t){var n=a()(t,2),r=n[0],o=n[1],i=r.prefix;return!!e.startsWith(i)&&(o[e.slice(i.length)]=-1,!0)}))}));var s=function(e,t){e[t]<0?e[t]=1:e[t]||(e[t]=2)};w.scripts.forEach((function(o){var i=o.props.id;s(r,i),s(e,i),o.custom.pathMap||$(o);var a=o.custom.pathMap;o.meta.require.forEach((function(e){s(n,a[e]||e)})),Object.values(o.meta.resources).forEach((function(e){s(t,a[e]||e)}));var u=o.meta.icon;if(Object(c.n)(u)){var l=a[u]||u;s(t,l)}})),o.forEach((function(e){var t=a()(e,2),n=t[0],r=t[1];Object.keys(r).forEach((function(e){var t=r[e];t<0?n.remove(e):2===t&&n.fetch&&n.fetch(e)}))}))}))}}).call(this,n(16))},79:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var r,o,i,a,c,s,u,l,d=n(12),f=n.n(d);function p(){return window.rea}function h(){return window.Registry}(r=window).rea={globals:window,extend(e){!function e(t,n){for(var r in t)if(t.hasOwnProperty(r))if(Object.getOwnPropertyDescriptor(t,r).get)n.__defineGetter__(r,t.__lookupGetter__(r));else{var o=t[r],i=typeof o;"undefined"!=i&&(null===o?n[r]=o:"object"==i?(n[r]=n[r]||{},e(o,n[r])):"array"==i?(n[r]=n[r]||[],e(o,n[r])):n[r]=o)}}(e,r.rea)}},r.rea.extend({content:{onReady(e){"prerender"!==document.webkitVisibilityState?e():document.addEventListener("webkitvisibilitychange",(function t(){"prerender"!==document.webkitVisibilityState&&(document.removeEventListener("webkitvisibilitychange",t,!1),e())}),!1)}},runtime:(o={},o.__defineGetter__("lastError",(function(){return chrome.runtime.lastError})),o.__defineGetter__("id",(function(){return chrome.runtime.id})),o.__defineGetter__("short_id",(function(){return o.id.replace(/[^0-9a-zA-Z]/g,"").substr(0,4)})),o),extension:{getURL:e=>chrome.runtime.getURL(e),sendMessage:(e,t)=>chrome.runtime.sendMessage(e,t),onMessage:{addListener:e=>chrome.runtime.onMessage.addListener(e)},connect:e=>chrome.runtime.connect(e)}}),r.rea.extend(function(){var e=20,t="537.33",n=!1;try{n=-1!=navigator.userAgent.search("OPR/")}catch(e){}try{t=parseInt(navigator.userAgent.match(/AppleWebKit\/([0-9]+\.[0-9]+)/)[1])}catch(e){}try{e=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2])}catch(e){}var r={CONSTANTS:{STORAGE:{SCHEMA:"#schema",TYPE:"#storage",CONFIG:"#config",VERSION:"#version",LEGACY_VERSION:"AWE_version",LAST_START:"#laststart",UPDATE:"#update",BEGGING:"#begging"},PREFIX:{SCRIPT_UID:"@uid#",COND:"@re#",STORE:"@st#",SCRIPT:"@source#",EXTERNAL:"@ext#",META:"@meta#"}},RUNTIME:{BROWSER:n?"opera":"chrome",CHROME:!n,OPERA:n,BROWSER_VERSION:e,WEBKIT_VERSION:t,ALLOWS_FAST_DOCUMENT_START:!0,ALLOWS_FILE_SCHEME_ACCESS:null,MAX_SCRIPTS:1e3,CAN_SAVEAS_ZIP:!0,CONTEXT_MENU:!0,INCOGNITO_MODE:!0},ACTIONMENU:{COLUMNS:3,CLOSE_ALLOWED:!0},OPTIONPAGE:{CLOSE_ALLOWED:!1},DB:{USE:null,DEFAULT:"chromeStorage"},XMLHTTPREQUEST:{RETRIES:0,PARTIAL_SIZE:16777216},DOWNLOAD:{SUPPORTED:e>=31},SCRIPT_DOWNLOAD:{TIMEOUT:15},PINGPONG:{RETRIES:10},MISC:{TIMEOUT:1,IDLE_TIMEOUT:30,DISTURBANCE_ALLOWED:60},WEBREQUEST:{use:!0,headers:!0,id:0,prefix:"TM_"},SYNC:{GOOGLE_DRIVE:{SUPPORTED:!1,HAS_SERVICE_STATUS:!1}},HTML5:{LOCALSTORAGE:null},LOCALE:{DEFAULT:null},REQUESTS:{HAS_SENDER_ID:!0,INTERNAL_PAGE_PROTOCOL:"chrome-extension:",GET_INTERNAL_PATH_REGEXP(e,t){var n=/(\/|\.|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;return RegExp(`${`${r.REQUESTS.INTERNAL_PAGE_PROTOCOL}//${rea.runtime.id}/`.replace(n,"\\$1")}([a-zA-Z${e?"\\/":""}]*)${(t||"").replace(n,"\\$1")}`)},GET_INTERNAL_PAGE_REGEXP:()=>r.REQUESTS.GET_INTERNAL_PATH_REGEXP(!1,".html")},OPTIONS:{HAS_CSP:!0,HAS_TESLA:!n,HAS_DOWNLOADS:!0,NATIVE_SCRIPT_IMPORT:!0,CAN_DOWNLOAD:!0}};return{FEATURES:r}}()),i=window.rea,a=i.FEATURES,i.extend({extension:{onConnect:{addListener:e=>chrome.runtime.onConnect.addListener(e)},onConnectExternal:{addListener:e=>chrome.runtime.onConnectExternal.addListener(e)},manifest:chrome.runtime.getManifest(),inIncognitoContext:chrome.extension.inIncognitoContext,getViews:e=>chrome.extension.getViews(e),isAllowedFileSchemeAccess:e=>chrome.extension.isAllowedFileSchemeAccess(e),urls:{prepareForReport:e=>e}},runtime:{onInstalled:{addListener(e){chrome.runtime.onInstalled&&chrome.runtime.onInstalled.addListener(e)}},onUpdateAvailable:{addListener(e){chrome.runtime.onUpdateAvailable&&chrome.runtime.onUpdateAvailable.addListener(e)}}},tabs:{onActivated:{addListener:e=>chrome.tabs.onActivated.addListener(e)},onUpdated:{addListener:e=>chrome.tabs.onUpdated.addListener(e)},onReplaced:{addListener(e){if(chrome.tabs.onReplaced)return chrome.tabs.onReplaced.addListener(e)}},onRemoved:{addListener:e=>chrome.tabs.onRemoved.addListener(e)},create:(e,t)=>chrome.tabs.create(e,t),update:(e,t,n)=>chrome.tabs.update(e,t,n),remove:(e,t)=>chrome.tabs.remove(e,t),highlight(e,t){if(e&&e.tabs){e.tabs instanceof Array||(e.tabs=[e.tabs]);var n,r=[];!function o(){if(!e.tabs.length)return chrome.tabs.highlight({windowId:n,tabs:r},t);var i=e.tabs.pop();chrome.tabs.get(i,(function(e){void 0===n&&(n=e.windowId),e.windowId===n&&r.push(e.index),o()}))}()}else t&&t()},getSelected:(e,t)=>chrome.tabs.getSelected(e,t),query:(e,t)=>chrome.tabs.query(e,t),sendMessage:(e,t,n)=>chrome.tabs.sendMessage(e,t,n)},webRequest:{headerModificationSupported:!0,onBeforeRequest:{addListener:(e,t,n)=>chrome.webRequest.onBeforeRequest.addListener(e,t,n),removeListener:e=>chrome.webRequest.onBeforeRequest.removeListener(e)},onBeforeSendHeaders:{addListener:(e,t,n)=>chrome.webRequest.onBeforeSendHeaders.addListener(e,t,n),removeListener:e=>chrome.webRequest.onBeforeSendHeaders.removeListener(e)},onHeadersReceived:{addListener:(e,t,n)=>chrome.webRequest.onHeadersReceived.addListener(e,t,n),removeListener:e=>chrome.webRequest.onHeadersReceived.removeListener(e)},onCompleted:{addListener:(e,t,n)=>chrome.webRequest.onCompleted.addListener(e,t,n),removeListener:e=>chrome.webRequest.onCompleted.removeListener(e)},handlerBehaviorChanged:e=>chrome.webRequest.handlerBehaviorChanged(e)},webNavigation:{supported:!!chrome.webNavigation,onCommitted:{addListener(e){if(chrome.webNavigation.onCommitted)return chrome.webNavigation.onCommitted.addListener(e)}}},browserAction:{setIcon:(e,t)=>chrome.browserAction.setIcon(e,t),setTitle:e=>chrome.browserAction.setTitle(e),setBadgeText:e=>chrome.browserAction.setBadgeText(e),setBadgeBackgroundColor:e=>chrome.browserAction.setBadgeBackgroundColor(e),setPopup:e=>chrome.browserAction.setPopup(e)},storage:{onChanged:{addListener:e=>chrome.storage.onChanged.addListener(e)},local:{set:(e,t)=>chrome.storage.local.set(e,t),get:(e,t)=>chrome.storage.local.get(e,t),remove:(e,t)=>chrome.storage.local.remove(e,t),clear:e=>chrome.storage.local.clear(e)},sync:{set:(e,t)=>chrome.storage.sync.set(e,t),get:(e,t)=>chrome.storage.sync.get(e,t),remove:(e,t)=>chrome.storage.sync.remove(e,t),clear:e=>chrome.storage.sync.clear(e)}},syncFileSystem:{onFileStatusChanged:{addListener:e=>chrome.syncFileSystem.onFileStatusChanged.addListener(e)},onServiceStatusChanged:{addListener:e=>chrome.syncFileSystem.onServiceStatusChanged.addListener(e)},supported:!!chrome.syncFileSystem},contentSettings:{javascript:{set:(e,t)=>chrome.contentSettings.javascript.set(e,t),get:(e,t)=>chrome.contentSettings.javascript.get(e,t),clear:(e,t)=>chrome.contentSettings.javascript.clear(e,t)}},downloads:{onChanged:{addListener:e=>chrome.downloads.onChanged.addListener(e)},download:(e,t)=>chrome.downloads.download(e,t)},commands:{supported:!(!chrome.commands||!chrome.commands.onCommand),onCommand:{addListener:e=>chrome.commands.onCommand.addListener(e)}},management:{getAll:e=>chrome.management.getAll(e),setEnabled:(e,t,n)=>chrome.management.setEnabled(e,t,n),uninstall:(e,t,n)=>chrome.management.uninstall(e,t,n)},notifications:{onPermissionLevelChanged:{addListener:e=>chrome.notifications.onPermissionLevelChanged.addListener(e)},onClicked:{addListener:e=>chrome.notifications.onClicked.addListener(e)},onClosed:{addListener:e=>chrome.notifications.onClosed.addListener(e)},supported:!!(chrome.notifications&&chrome.notifications.getPermissionLevel&&chrome.notifications.onPermissionLevelChanged&&chrome.notifications.onClicked),getPermissionLevel:e=>chrome.notifications.getPermissionLevel(e),create:(e,t,n)=>chrome.notifications.create(e,t,n),clear:(e,t)=>chrome.notifications.clear(e,t)},contextMenus:function(){var e=!!(a.RUNTIME.CONTEXT_MENU&&chrome.contextMenus&&chrome.contextMenus.create&&chrome.contextMenus.update&&chrome.contextMenus.remove);return e?{supported:e,create:(e,t)=>chrome.contextMenus.create(e,t),update:(e,t,n)=>chrome.contextMenus.update(e,t,n),remove:(e,t)=>chrome.contextMenus.remove(e,t),removeAll:e=>chrome.contextMenus.removeAll(e),onClicked:{addListener:e=>chrome.contextMenus.onClicked.addListener(e)}}:{supported:!1}}(),permissions:{supported:!0,getAll:e=>chrome.permissions.getAll(e),request:(e,t)=>chrome.permissions.request(e,t),remove:(e,t)=>chrome.permissions.remove(e,t)},i18n:{native_support:!0,getMessage(){return chrome.i18n.getMessage.apply(this,arguments)},getUILanguage:()=>chrome.i18n.getUILanguage?chrome.i18n.getUILanguage():null,getAcceptLanguages:e=>chrome.i18n.getAcceptLanguages?chrome.i18n.getAcceptLanguages(e):e([])},idle:{queryState:(e,t)=>chrome.idle.queryState(e,t)},other:function(){var e={openDatabase(e,t,n,r){var o=window.openDatabase;if(o)return o(e,t,n,r)},requestFileSystem(e,t,n,r){var o=window.requestFileSystem||window.webkitRequestFileSystem;if(o)return o(e,t,n,r);r("not supported")}};return e.__defineGetter__("webkitNotifications",(function(){return window.webkitNotifications})),e}()}),function(){try{a.HTML5.LOCALSTORAGE=window.localStorage}catch(e){console.warn("prep: window.localStorage will be unavailable")}a.DB.USE=a.DB.DEFAULT;try{a.HTML5.LOCALSTORAGE&&(a.DB.NO_WARNING="nowarning"===a.HTML5.LOCALSTORAGE.getItem("#brokenprofile"),a.DB.USE=a.HTML5.LOCALSTORAGE.getItem(a.CONSTANTS.STORAGE.TYPE)||a.DB.DEFAULT)}catch(e){console.warn("prep: error at storage type detection",e)}i.extension.isAllowedFileSchemeAccess((function(e){a.RUNTIME.ALLOWS_FILE_SCHEME_ACCESS=e,a.INITIALIZED=!0}))}(),c="undefined"!=typeof rea?rea.globals:window,s=function(){var e=[],t=function(t,r,o){var a=1,c=function(){return t.every((function(e){return!!n[e]}))},s=function t(){e.push((function(){c()?o():t()}))},u=function(e){0==--a&&o&&(r||c()?o():s())};(t="string"==typeof t?[t]:t).forEach((function(e){void 0===n[e]&&(n[e]=null,i.loadFile(rea.extension.getURL(e+".js"),(function(){u()})),a++)})),u()},n={},r={},o={},i={init(){},verify(e){var t,n=[];for(t in r)r.hasOwnProperty(t)&&(r[t].length>3&&"###"===r[t].substr(0,3)?console.debug("self.verify: development version detected @ "+t):r[t]!==e&&(console.warn(`self.verify: expected version ${e} and detected ${r[t]} @ ${t}`),n.push({name:t,version:r[t],expected:e})));return n},register(t,o,i,a){if(!n[t]||a)for(r[t]=o,n[t]=i,t=e,e=[];t.length;)t.pop()()},registerRaw(e,t,n,i){o[e]&&!i||(r[e]=t,o[e]=n)},vendor:(e,n)=>t(e,!0,n),require:(e,n)=>t(e,!1,n),getRaw(e){var t=null;if(void 0!==o[e])t=o[e];else{var n=rea.extension.getURL(e);try{var r=new XMLHttpRequest;r.open("GET",n,!1),r.send(null),(t=r.responseText)||console.log(`WARN: content of ${e} is null!`)}catch(e){console.log("getRawContent "+e)}}return t},loadFile(e,t){try{var n=document.createElement("script");n.setAttribute("src",e),n.onload=function(){t&&t(e)},(document.head||document.body||document.documentElement||document).appendChild(n)}catch(t){console.log(`Error: self.load ${e} failed! ${t.message}`)}},isDevVersion:e=>r[e]&&"###"===r[e].substr(0,3),get(e){var t,r=n[e];return"function"==typeof r?(t=Array.prototype.slice.call(arguments,1),t=r.apply(this,t)):r&&(t=r),t}};return i}(),window.setTimeout(s.init,1),c.Registry=s,u="undefined"!=typeof window?window:GLOBAL,(l=function e(t){var n=function(){var t,n,r=[];r.notify=function(e){r.forEach((function(t){t(e)}))};var o=[];o._push=o.push,o.push=function(){o._push.apply(o,arguments),o.check()},o.check=function(){if(void 0!==t)for(var e;o.length;)(void 0===(e=o.shift()).state||e.state===t)&&(n=("function"==typeof e.f?e.f.call(i,n):e.f)||n)};var i={promise:()=>i,done:e=>(o.push({state:!0,f:e}),i),fail:e=>(o.push({state:!1,f:e}),i),always:e=>(o.push({f:e}),i),progress:e=>(r.push(e),i),then:(t,r,o)=>e((function(e){[{fn:"done",forward:"resolve",f:t},{fn:"fail",forward:"reject",f:r},{fn:"progress",forward:"notify",f:o}].forEach((function(t){i[t.fn]((function(){var r="function"==typeof t.f,o=r?t.f(n):void 0;o&&"function"==typeof o.promise?o.promise().done(e.resolve).fail(e.reject).progress(e.notify):e[t.forward].apply(e,f()(r?[o]:arguments))}))}))})).promise(),each:t=>i.then((function(n){return n instanceof Array||(n=arguments),e.when(n.map((function(e){return t(e)})))})),iterate:t=>i.then((function(n){n instanceof Array||(n=arguments);var r=0,o=e(),i=function e(){if(r<n.length){var i=n[r++];(i=t(i))&&i.promise?i.promise().done(e).fail(o.reject):e()}else o.resolve(n)};return i(),o.promise()}))};return{get:()=>i,try_resolve(e){void 0===t&&(t=!0,n=e),o.check()},try_reject(e){void 0===t&&(t=!1,n=e),o.check()},do_notify(e){r.notify(e)}}}(),r={promise:()=>n.get(),resolve(){return n.try_resolve.apply(this,arguments)},reject(){return n.try_reject.apply(this,arguments)},notify(){return n.do_notify.apply(this,arguments)}};return t&&t(r),r}).Pledge=function(e){var t=l();return t.resolve(e),t.promise()},l.Breach=function(e){var t=l();return t.reject(e),t.promise()},l.onebyone=function(e){var t=[];return e.reduce((function(e,n){return e.then(n).done((function(e){t=t.concat(e instanceof Array?e:[e])}))}),l.Pledge()).then((function(){return t}))},l.sidebyside=function(e){e instanceof Array||(e=arguments);var t=l(),n=e.length;return n?e.forEach((function(e){e&&e.promise&&e.promise().always((function(){0==--n&&t.resolve()}))})):t.resolve(),t.promise()},l.when=function(e){e instanceof Array||(e=arguments);var t=l(),n=e.length,r=[];return n?e.forEach((function(e){e&&e.promise&&e.promise().fail((function(){t.reject(r),n=-1})).done((function(e){r.push(e),0==--n&&t.resolve(r)}))})):t.resolve(r),t.promise()},u.Registry?u.Registry.register("promise","58",(function(){return l})):e.exports.Deferred=l,Registry.require(["promise"],(function(){var e=rea.FEATURES,t=Registry.get("promise"),n=!0,r=!1,o=[],i=!0,a=function(){var t=[e.CONSTANTS.STORAGE.VERSION,e.CONSTANTS.STORAGE.TYPE],n={};return t.forEach((function(e){n[e]=!0})),{keys:t,has:e=>!!n[e]}}(),c=e.HTML5.LOCALSTORAGE,s=function(){return rea.other.openDatabase("tmStorage","1.0","TM Storage",31457280)},u=function(e,t){if(!e)return t;var n=e[0];switch(e=e.substring(1),n){case"b":return"true"==e;case"n":return Number(e);case"o":try{return JSON.parse(e)}catch(e){console.error("Storage: getValue ERROR: "+e.message)}return t;default:return e}},l=function(e){var t=(typeof e)[0];switch(t){case"o":try{e=t+JSON.stringify(e)}catch(e){return void console.error("Storage: setValue ERROR: "+e.message)}break;default:e=t+e}return e},d=function(n,r){var o,i=t(),a=Array.prototype.slice.call(arguments,2);if("string"==typeof n?n==e.DB.USE&&"clean"==r?console.warn("Storage: can't clean currently active storage"):o=h.implementations[n][r]:o=n[r],o){if("object"!=typeof(a=o.apply(this,a))||!a.then)return a;a.then((function(){i.resolve.apply(this,arguments)}),(function(e){i.reject()}))}else i.resolve();return i.promise()},f=function(e,n){var r=t(),o=[];return Object.getOwnPropertyNames(n).forEach((function(t){void 0!==n[t]&&o.push(d(e,"setValue",t,n[t]))})),t.when(o).done((function(){r.resolve()})),r.promise()},p=function(e,t){var n={};return t.forEach((function(t){n[t]=d(e,"getValue",t)})),n},h={implementations:{localStorage:function(){var e={setValue(e,n){var o=t();r&&console.log("localStorage: setValue -> "+e);var a=l(n);return i&&c.setItem(e,a),o.resolve(),o.promise()},getValue:(e,t)=>(r&&console.log("Storage: getValue -> "+e),u(c.getItem(e,t),t)),deleteAll(){var n=t();return r&&console.log("localStorage: deleteAll()"),i&&e.listValues().forEach((function(e){a.has(e)||c.removeItem(e)})),n.resolve(),n.promise()},deleteValue(e){var n=t();return r&&console.log("localStorage: deleteValue -> "+e),i&&c.removeItem(e),n.resolve(),n.promise()},listValues(){r&&console.log("localStorage: listValues");for(var e=[],t=0;t<c.length;t++)e.push(c.key(t));return e}};return{options:{},methods:e}}(),sql:function(){var e=null,n=null,o=function(){var e=t();return n.db.transaction((function(t){t.executeSql("CREATE TABLE IF NOT EXISTS config(ID INTEGER PRIMARY KEY ASC, name TEXT, value TEXT)",[],e.resolve,n.onError)})),e.promise()},c=function(){var e=t();return(n={db:s(),onSuccess(e,t){r&&console.log("webSQL: localDB Success ")},onError(e,t){console.error("webSQL: localDB Error ",t)}}).db?o().done(e.resolve):(n=null,e.reject()),e.promise()},d={setValue(o,a){var c=t();r&&console.log("Storage: setValue -> "+o);var s=l(a);return i&&(e[o]?n.db.transaction((function(e){e.executeSql("UPDATE config SET value=? WHERE name=?",[s,o],(function(){rea.runtime.lastError&&console.warn(rea.runtime.lastError),c.resolve()}),n.onError)})):n.db.transaction((function(e){e.executeSql("INSERT INTO config(name, value) VALUES (?,?)",[o,s],(function(){rea.runtime.lastError&&console.warn(rea.runtime.lastError),c.resolve()}),n.onError)}))),e[o]=s,i||c.resolve(),c.promise()},getValue:(t,n)=>(r&&console.log("webSQL: getValue -> "+t),u(e[t],n)),deleteAll(){var c=t();r&&console.log("webSQL: deleteAll()");var s=p(d,a.keys);return e=s,i?n.db.transaction((function(e){e.executeSql("DROP TABLE config",[],(function(){o().done((function(){f(d,s).done(c.resolve)}))}),n.onError)})):c.resolve(),c.promise()},deleteValue(o){var a=t();return r&&console.log("webSQL: deleteValue -> "+o),delete e[o],i?n.db.transaction((function(e){e.executeSql("DELETE FROM config WHERE name=?",[o],a.resolve,n.onError)})):a.resolve(),a.promise()},listValues(){r&&console.log("webSQL: listValues");var t=[];return Object.getOwnPropertyNames(e).forEach((function(e){t.push(e)})),t},isWorking:()=>t.Pledge()};return{init(){var r=t(),o=function(t,n){if(e={},n)for(var o=0;o<n.rows.length;o++)e[n.rows.item(o).name]=n.rows.item(o).value;r.resolve()},i=function(){e?r.resolve():n.db.transaction((function(e){e.executeSql("SELECT * FROM config",[],o,n.onError)}))};return n?i():c().done(i).fail(r.reject),r.promise()},clean:()=>(e=null,t.Pledge()),options:{},methods:d}}(),chromeStorage:function(){var e=null,o=!1,c=!1,s=rea.extension.inIncognitoContext?"incognito":"normal",u=function(t,n){if(i&&c&&"local"==n)for(var o in t){var a=t[o];r&&console.log("si: local storage key",o,"@",n,"changed:",a),a.newValue?a.newValue.origin!==s&&(e[o]=a.newValue.value,h.notifyDifferentOriginChangeListeners(o,a.newValue)):delete e[o]}},l={setValue(n,o){var a=t();if(r&&console.log("chromeStorage: setValue -> ",n,o),e[n]=o,i){var c={};c[n]={origin:s,value:o},rea.storage.local.set(c,a.resolve)}else a.resolve();return a.promise()},getValue(t,n){var o=void 0===e[t]?n:e[t];return r&&console.log("chromeStorage: getValue -> ",t,o),o},deleteAll(){var n=t();r&&console.log("chromeStorage: deleteAll()");var o=p(l,a.keys);return e=o,i?rea.storage.local.clear((function(){f(l,o).done(n.resolve)})):n.resolve(),n.promise()},deleteValue(n){var o=t();return r&&console.log("chromeStorage: deleteValue -> "+n),delete e[n],i?rea.storage.local.remove(n,o.resolve):o.resolve(),o.promise()},listValues(){r&&console.log("chromeStorage: listValues");var t=[];return Object.getOwnPropertyNames(e).forEach((function(e){t.push(e)})),t},setTemporary(e){i=!e,c=!0},isSupported:()=>t.Pledge(),isWorking(){var e=t(),r=0,o=(new Date).getTime(),i={};i.foo=o;var a=function(t){++r<=5?(console.warn("storage:",t||"storage set/get test failed!"),window.setTimeout(s,r*r*100)):(console.warn("storage: storage set/get test finally failed!"),c&&(window.clearTimeout(c),c=null,e.reject()))},c=window.setTimeout((function(){c=null}),18e4),s=function(){n&&console.log("Storage: test -> start");var t=(new Date).getTime();rea.storage.local.set(i,(function(){n&&console.log(`Storage: test -> set after ${(new Date).getTime()-t}ms`),rea.storage.local.get("foo",(function(r){return n&&console.log(`Storage: test -> get after ${(new Date).getTime()-t}ms`),r?r.foo!==o?a(`read value is different ${JSON.stringify(r.foo)} != ${JSON.stringify(o)}`):rea.runtime.lastError?a(rea.runtime.lastError&&rea.runtime.lastError.message||"lastError is set"):void rea.storage.local.remove("foo",(function(){n&&console.log(`Storage: test -> remove after ${(new Date).getTime()-t}ms`),c&&(window.clearTimeout(c),c=null,e.resolve())})):a("read value is"+r)}))}))};return s(),e.promise()}};return{init(){var n=t();return e?n.resolve():rea.storage.local.get(null,(function(t){for(var r in e={},t){var i=t[r];e[r]=i&&i.hasOwnProperty("origin")&&i.hasOwnProperty("value")?i.value:i}o||(rea.storage.onChanged.addListener(u),o=!0),n.resolve()})),n.promise()},clean(){var n=t();return e=null,n.resolve(),n.promise()},options:{},methods:l}}(),file:function(){var e=null,n=null,o=function(){var e=t(),r=function(t){console.warn("fileStorage: listFiles() error:",t),e.reject()};return n.root.getDirectory("data",{create:!0},(function(t){var n=t.createReader(),o=[];!function t(){n.readEntries((function(n){n.length?(o=o.concat(n),t()):e.resolve(o)}),r)}()}),r),e.promise()},c=function(e,r){var o=t(),i=function(t){console.warn("fileStorage: writeFileData(",e,") error:",t),o.reject()};return n.root.getDirectory("data",{create:!0},(function(t){t.getFile(e,{create:!0},(function(e){e.createWriter((function(e){e.onwriteend=function(t){e.onwriteend=function(e){o.resolve()},e.onerror=i,t=new Blob([r],{type:"text/plain"}),e.write(t)},e.truncate(0)}),i)}),i)}),i),o.promise()},s=function(e){var r=t(),o=function(t){console.warn("fileStorage: getFileData(",e,") error:",t),r.reject()},i=function(e){var t=new FileReader;t.onloadend=function(){r.resolve(this.result)},t.onerror=o,t.onabort=o,t.readAsText(e)};return n.root.getDirectory("data",{create:!0},(function(t){t.getFile(e,{},(function(e){e.file((function(e){i(e)}),o)}),o)}),o),r.promise()},d=function(e){var r=t(),o=function(t){console.warn("fileStorage: deleteFile(",e,") error:",t),r.reject()};return n.root.getDirectory("data",{create:!0},(function(t){t.getFile(e,{create:!1},(function(e){e.remove(r.resolve,o)}),o)}),o),r.promise()},h=function(){var e=t(),r=function(t){console.warn("fileStorage: removeDir() error:",t),e.reject()};return n.root.getDirectory("data",{create:!0},(function(t){t.removeRecursively(e.resolve,r)}),r),e.promise()},m=function(){var n=t();e={};var r=[];return o().done((function(o){o.forEach((function(t){"string"!=typeof t&&(t=t.name),r.push(s(t).always((function(n){e[t]=n})))})),t.when(r).always((function(){n.resolve()}))})).fail(n.resolve),n.promise()},v={isSupported(){var e=t();return window.File&&window.FileReader&&window.FileList&&window.Blob?e.resolve():e.reject(),e.promise()},isWorking:()=>t.Pledge(),setValue(n,o){var a=t();r&&console.log("fileStorage: setValue -> "+n);var s=l(o);return e[n]=s,i?c(n,s).always(a.resolve):a.resolve(),a.promise()},getValue:(t,n)=>(r&&console.log("fileStorage: getValue -> "+t),u(e[t],n)),deleteAll(){var n=t();r&&console.log("fileStorage: deleteAll()");var o=p(v,a.keys);return e=o,i?h().always((function(){f(v,o).always(n.resolve)})):n.resolve(),n.promise()},deleteValue(n){var o=t();return r&&console.log("fileStorage: deleteValue -> "+n),delete e[n],i?d(n).always(o.resolve):o.resolve(),o.promise()},listValues(){r&&console.log("fileStorage: listValues");var t=[];return Object.getOwnPropertyNames(e).forEach((function(e){t.push(e)})),t}};return{init(){var r=t();return e?r.resolve():rea.other.requestFileSystem(window.PERSISTENT,31457280,(function(e){n=e,m().done(r.resolve)}),(function(e){e&&console.warn("fileStorage: ",e),r.reject()})),r.promise()},clean:()=>(e=null,t.Pledge()),options:{},methods:v}}()},migrate(e,n,o){var i=t(),a=h.implementations[e],c=h.implementations[n];return o=o||{},a&&c?(r&&console.log("Migration: from",e,"to",n),d(e,"init").then((function(){return d(n,"init")})).then((function(){var e=t(),n=[];return a.methods.listValues().forEach((function(e){var t=a.methods.getValue(e);o.drop&&n.push(a.methods.deleteValue(e)),r&&console.log("Migration: copy value of "+e),n.push(c.methods.setValue(e,t))})),t.when(n).done((function(){e.resolve()})),e.promise()})).then((function(){return d(n,"clean")})).then((function(){return d(e,"clean")})).done((function(){i.resolve()})).fail((function(){i.reject()}))):(console.error("Migration: unknown storage implementation(s) ",e,n),i.reject()),i.promise()},isSupported:()=>t.Pledge(),isWorking:()=>t.Pledge(),setTemporary(e){i=!e},init:()=>(n&&console.log("Storage: use "+e.DB.USE),Object.getOwnPropertyNames(h.implementations[e.DB.USE].methods).forEach((function(t){h.__defineGetter__(t,(function(){return h.implementations[e.DB.USE].methods[t]}))})),h.implementations[e.DB.USE].init?h.implementations[e.DB.USE].init():t.Pledge()),getValues(t,n){var r={};return n||(n={}),Object.getOwnPropertyNames(t).forEach((function(t){r[t]=h.implementations[e.DB.USE].getValue(t,n[t])})),r},factoryReset:()=>(c.removeItem(e.CONSTANTS.STORAGE.LEGACY_VERSION),h.deleteAll()),isWiped(){if("localStorage"===e.DB.USE)return t.Pledge(!1);var n=t(),r=h.getValue(e.CONSTANTS.STORAGE.VERSION),o=!1;return c.getItem(e.CONSTANTS.STORAGE.LEGACY_VERSION)&&!r&&(h.listValues().length?console.warn("storage: unable to find version information"):o=!0),n.resolve(o),n.promise()},setVersion(n,r){var o=t();return i?(c.setItem(e.CONSTANTS.STORAGE.LEGACY_VERSION,n),h.setValue(e.CONSTANTS.STORAGE.VERSION,n).then((function(){return r?h.setValue(e.CONSTANTS.STORAGE.SCHEMA,r):t.Pledge()})).always(o.resolve)):o.resolve(),o.promise()},getVersion(n){var r=t(),o=h.getValue(e.CONSTANTS.STORAGE.VERSION)||h.getValue(e.CONSTANTS.STORAGE.LEGACY_VERSION)||c.getItem(e.CONSTANTS.STORAGE.LEGACY_VERSION);return o?r.resolve(o):d("sql","init").then((function(t){return o=h.implementations.sql.methods.getValue(e.CONSTANTS.STORAGE.LEGACY_VERSION)||n,d("sql","clean")})).always((function(){r.resolve(o||n)})),r.promise()},getSchemaVersion:()=>h.getValue(e.CONSTANTS.STORAGE.SCHEMA,"3.5"),debug(e,t){r|=t,n|=e},addDifferentOriginChangeListener(e,t){o.push({search:e,cb:t})},notifyDifferentOriginChangeListeners(e,t){for(var n in o){var r=o[n];0==e.search(r.search)&&r.cb(e,t)}},recover(e,t){"string"==typeof e&&(e={method:e,storages:["sql","chromeStorage"]});var n={};if(e.storages.forEach((function(e){n[e]=!0})),"log"==e.method){var r,o,i=null,a=[{method:"sql",fn(e){console.debug("check sql storage for data...");try{if(o=s(),rea.runtime.lastError||!o)return i=rea.runtime.lastError,e();o.transaction((function(t){t.executeSql("CREATE TABLE IF NOT EXISTS config(ID INTEGER PRIMARY KEY ASC, name TEXT, value TEXT)",[],(function(){console.debug("sql table found/created"),e()}),(function(t,n){i=n,e()}))}))}catch(t){i=t,window.setTimeout(e,1)}}},{method:"sql",fn(e){var t={};o.transaction((function(n){n.executeSql("SELECT * FROM config",[],(function(n,o){if(o)for(var i=0;i<o.rows.length;i++)t[o.rows.item(i).name]=o.rows.item(i).value;r=t,window.setTimeout(e,1)}),(function(t,n){i=n,e()}))}))}},{method:"sql",fn(e){var t=r?Object.getOwnPropertyNames(r):[];r&&t.length?(console.debug("found values:"),t.forEach((function(e){console.debug("    ",e,r[e]&&r[e].length>30?r[e].substr(0,30):r[e])}))):(console.warn("no data found"),n.sql=!1),window.setTimeout(e,1)}},{method:"chromeStorage",fn(e){console.debug("check chromeStorage for data..."),rea.storage.local.get(null,(function(t){r=t,e()}))}},{method:"chromeStorage",fn(e){var t=r?Object.getOwnPropertyNames(r):[];r&&t.length?(console.debug("found values:"),t.forEach((function(e){console.debug("    ",e,r[e]&&r[e].length>30?r[e].substr(0,30):r[e])}))):(console.warn("no data found"),n.chromeStorage=!1,window.setTimeout(e,1))}}],c=0;!function e(){if(i)console.warn("error:",i);else for(;a[c];){if(n[a[c].method])return a[c].fn(e),void c++;c++}t&&t()}()}}};Registry.register("storage","58",(function(){return h}))}))}).call(this,n(166)(e))},80:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c}));var r=n(0),o=n(13),i={};function a(e,t){var n=e.url,r=e.active,a=t.tab||{},c={url:n,active:r,windowId:a.windowId,index:a.index+1};return o.d&&o.b||(c.openerTabId=a.id),browser.tabs.create(c).then((function(e){var t=e.id;return i[t]=a.id,{id:t}}))}function c(e,t){var n=e&&e.id||t.tab&&t.tab.id;n&&browser.tabs.remove(n)}browser.tabs.onRemoved.addListener((function(e){var t=i[e];t&&(browser.tabs.sendMessage(t,{cmd:"TabClosed",data:e}).catch(r.p),delete i[e])}))},89:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));var r,o=document.createElement("textarea");function i(t){r=t,o.focus(),!document.execCommand("copy",!1,null)&&e.env.DEBUG&&console.warn("Copy failed!")}document.body.appendChild(o),document.addEventListener("copy",(function(e){e.preventDefault();var t=r,n=t.type,o=t.data;e.clipboardData.setData(n||"text/plain",o)}),!1)}).call(this,n(16))},90:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r=n(0),o=n(5),i=n(11),a=n(23),c=n(15),s={};function u(t){var n=t.props.id,u=s[n];if(!u){var l=!1;u=function(e){var t={checking:!0},n={cmd:"UpdateScript",data:{where:{id:e.props.id},update:t}},o=e.custom.downloadURL||e.meta.downloadURL||e.custom.lastInstallURL,a=e.custom.updateURL||e.meta.updateURL||o;return a?(t.message=Object(r.k)("msgCheckingForUpdate"),Object(c.c)(n),Object(r.r)(a,{headers:{Accept:"text/x-userscript-meta"}}).then((function(o){var a=o.data,s=Object(i.f)(a);return Object(i.a)(e.meta.version,s.version)<0?Promise.resolve():(t.checking=!1,t.message=Object(r.k)("msgNoUpdate"),Object(c.c)(n),Promise.reject())}),(function(){return t.checking=!1,t.message=Object(r.k)("msgErrorFetchingUpdateInfo"),Object(c.c)(n),Promise.reject()})).then((function(){return o?(t.message=Object(r.k)("msgUpdating"),Object(c.c)(n),Object(r.r)(o).then((function(e){return e.data}),(function(){return t.checking=!1,t.message=Object(r.k)("msgErrorFetchingScript"),Object(c.c)(n),Promise.reject()}))):(t.message=`<span class="new">${Object(r.k)("msgNewVersion")}</span>`,Object(c.c)(n),Promise.reject())}))):Promise.reject()}(t).then((function(e){return Object(o.o)({id:n,code:e,update:{checking:!1}})})).then((function(e){var t=e.data.update;l=!0,Object(a.c)("notifyUpdates")&&Object(c.b)({title:Object(r.k)("titleScriptUpdated"),body:Object(r.k)("msgScriptUpdated",[t.meta.name||Object(r.k)("labelNoName")])})})).catch((function(t){e.env.DEBUG&&console.error(t)})).then((function(){return delete s[n],l})),s[n]=u}return u}}).call(this,n(16))},95:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},96:function(e,t,n){"use strict";var r=n(11);t.a=function(){return new Promise((function(e,t){var n;console.info("Upgrade database..."),(n=indexedDB.open("AceScript",1)).onsuccess=function(){try{o=n.result,i=o.transaction(["scripts","require","cache","values"]),a={},c=3,s=function(){(c-=1)||e(browser.storage.local.set(a))},function(e,n){var o=e.objectStore("scripts"),i=[],a=o.openCursor();a.onsuccess=function(e){var t,o=e.target.result;if(o){var a=o.value;i.push((t=a,{script:{meta:Object(r.f)(t.code),custom:Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},t.custom),props:{id:t.id,uri:t.uri,position:t.position},config:{enabled:t.enabled,shouldUpdate:t.update}},code:t.code})),o.continue()}else n(i)},a.onerror=t}(i,(function(e){var n={};e.forEach((function(e){var t=e.script,r=e.code;a["scr:"+t.props.id]=t,a["code:"+t.props.id]=r,n[t.props.uri]=t.props.id})),function(e,n,r){var o=e.objectStore("values"),i=[],a=o.openCursor();a.onsuccess=function(e){var t=e.target.result;if(t){var o=t.value,a=o.uri,c=o.values,s=r[a];s&&i.push({id:s,values:c}),t.continue()}else n(i)},a.onerror=t}(i,(function(e){e.forEach((function(e){var t=e.id,n=e.values;a["val:"+t]=n})),s()}),n)})),function(e,n){var r=e.objectStore("cache"),o=[],i=r.openCursor();i.onsuccess=function(e){var t=e.target.result;if(t){var r=t.value,i=r.uri,a=r.data;o.push({uri:i,data:a}),t.continue()}else n(o)},i.onerror=t}(i,(function(e){e.forEach((function(e){var t=e.uri,n=e.data;a["cac:"+t]=n})),s()})),function(e,n){var r=e.objectStore("require"),o=[],i=r.openCursor();i.onsuccess=function(e){var t=e.target.result;if(t){var r=t.value,i=r.uri,a=r.code;o.push({uri:i,code:a}),t.continue()}else n(o)},i.onerror=t}(i,(function(e){e.forEach((function(e){var t=e.uri,n=e.code;a["req:"+t]=n})),s()}))}catch(e){t(e)}var o,i,a,c,s},n.onerror=t,n.onupgradeneeded=function(e){e.target.transaction.abort(),t()}})).catch((function(){}))}},97:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},98:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},99:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(0);function r(){}}});